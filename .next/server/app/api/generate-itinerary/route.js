"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/generate-itinerary/route";
exports.ids = ["app/api/generate-itinerary/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-itinerary%2Froute&page=%2Fapi%2Fgenerate-itinerary%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-itinerary%2Froute.ts&appDir=%2FUsers%2Fethanhoppe%2FDesktop%2FAItravelagent%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fethanhoppe%2FDesktop%2FAItravelagent&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-itinerary%2Froute&page=%2Fapi%2Fgenerate-itinerary%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-itinerary%2Froute.ts&appDir=%2FUsers%2Fethanhoppe%2FDesktop%2FAItravelagent%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fethanhoppe%2FDesktop%2FAItravelagent&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_ethanhoppe_Desktop_AItravelagent_app_api_generate_itinerary_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/generate-itinerary/route.ts */ \"(rsc)/./app/api/generate-itinerary/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/generate-itinerary/route\",\n        pathname: \"/api/generate-itinerary\",\n        filename: \"route\",\n        bundlePath: \"app/api/generate-itinerary/route\"\n    },\n    resolvedPagePath: \"/Users/ethanhoppe/Desktop/AItravelagent/app/api/generate-itinerary/route.ts\",\n    nextConfigOutput,\n    userland: _Users_ethanhoppe_Desktop_AItravelagent_app_api_generate_itinerary_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/generate-itinerary/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZnZW5lcmF0ZS1pdGluZXJhcnklMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmdlbmVyYXRlLWl0aW5lcmFyeSUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmdlbmVyYXRlLWl0aW5lcmFyeSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmV0aGFuaG9wcGUlMkZEZXNrdG9wJTJGQUl0cmF2ZWxhZ2VudCUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZldGhhbmhvcHBlJTJGRGVza3RvcCUyRkFJdHJhdmVsYWdlbnQmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQzJCO0FBQ3hHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYWktdHJhdmVsLWFnZW50Lz80Y2UyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9ldGhhbmhvcHBlL0Rlc2t0b3AvQUl0cmF2ZWxhZ2VudC9hcHAvYXBpL2dlbmVyYXRlLWl0aW5lcmFyeS9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvZ2VuZXJhdGUtaXRpbmVyYXJ5L3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvZ2VuZXJhdGUtaXRpbmVyYXJ5XCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9nZW5lcmF0ZS1pdGluZXJhcnkvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvZXRoYW5ob3BwZS9EZXNrdG9wL0FJdHJhdmVsYWdlbnQvYXBwL2FwaS9nZW5lcmF0ZS1pdGluZXJhcnkvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2dlbmVyYXRlLWl0aW5lcmFyeS9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-itinerary%2Froute&page=%2Fapi%2Fgenerate-itinerary%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-itinerary%2Froute.ts&appDir=%2FUsers%2Fethanhoppe%2FDesktop%2FAItravelagent%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fethanhoppe%2FDesktop%2FAItravelagent&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/generate-itinerary/route.ts":
/*!*********************************************!*\
  !*** ./app/api/generate-itinerary/route.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   maxDuration: () => (/* binding */ maxDuration),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _job_processor__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../job-processor */ \"(rsc)/./app/api/job-processor.ts\");\n/* harmony import */ var _lib_supabase__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/supabase */ \"(rsc)/./lib/supabase.ts\");\n\n\n\n// Configure runtime for serverless function\nconst runtime = \"nodejs\";\nconst maxDuration = 60; // Set max duration to 60 seconds\n// Use API key from environment variables\nconst OPENAI_API_KEY = process.env.OPENAI_API_KEY || \"\";\n// Check if running in production environment\nconst isProduction = \"development\" === \"production\";\n// Check if Supabase is properly configured\nconst isSupabaseConfigured = Boolean( true && \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvYWlla3F3ZmxvandpY2Vqdm5lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5MzM2MzMsImV4cCI6MjA2MDUwOTYzM30.E70hBHGjbvCJPjYpMmlMIMvyfyBlotOwP01YaXf37Mg\");\nasync function POST(request) {\n    try {\n        // Log environment variables (without exposing actual values)\n        console.log(\"Supabase connection check:\", {\n            hasSupabaseUrl: !!\"https://toaiekqwflojwicejvne.supabase.co\",\n            hasSupabaseKey: !!\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvYWlla3F3ZmxvandpY2Vqdm5lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5MzM2MzMsImV4cCI6MjA2MDUwOTYzM30.E70hBHGjbvCJPjYpMmlMIMvyfyBlotOwP01YaXf37Mg\",\n            urlLength: \"https://toaiekqwflojwicejvne.supabase.co\"?.length || 0,\n            keyLength: \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvYWlla3F3ZmxvandpY2Vqdm5lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5MzM2MzMsImV4cCI6MjA2MDUwOTYzM30.E70hBHGjbvCJPjYpMmlMIMvyfyBlotOwP01YaXf37Mg\"?.length || 0\n        });\n        // Only test Supabase connection if properly configured\n        if (isSupabaseConfigured) {\n            try {\n                const { data, error } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_2__.supabase.from(\"jobs\").select(\"count\").limit(1);\n                if (error) {\n                    console.error(\"Supabase connection test failed:\", {\n                        message: error.message,\n                        hint: error.hint || \"\",\n                        code: error.code || \"\"\n                    });\n                // Continue execution despite connection error\n                // The job will be stored in memory\n                } else {\n                    console.log(\"Supabase connection test successful:\", data);\n                }\n            } catch (connError) {\n                console.error(\"Supabase connection test exception:\", {\n                    message: connError.message,\n                    details: connError.toString(),\n                    hint: \"\",\n                    code: \"\"\n                });\n            // Continue execution despite connection error\n            // The job will be stored in memory\n            }\n        } else {\n            console.log(\"Skipping Supabase connection test - not configured\");\n        }\n        // Parse the request body\n        const surveyData = await request.json();\n        // Create a unique job ID\n        const jobId = (0,_job_processor__WEBPACK_IMPORTED_MODULE_1__.generateJobId)();\n        // If we're in development or testing, return mock data immediately\n        if ( true && !OPENAI_API_KEY.startsWith(\"sk-\")) {\n            console.log(\"Development mode: Returning mock data\");\n            const mockItinerary = createMockItinerary(surveyData);\n            const updateResult = await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_2__.updateJobStatus)(jobId, \"completed\", {\n                result: {\n                    itinerary: mockItinerary,\n                    prompt: generatePrompt(surveyData)\n                }\n            });\n            if (!updateResult) {\n                console.error(\"Failed to update job status in development mode\");\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Failed to update job status\"\n                }, {\n                    status: 500\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                jobId,\n                status: \"completed\"\n            });\n        }\n        // Create a new job\n        console.log(\"Creating new job with ID:\", jobId);\n        const jobCreated = await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_2__.createJob)(jobId);\n        if (!jobCreated) {\n            console.error(\"Failed to create job\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to create job in database\"\n            }, {\n                status: 500\n            });\n        }\n        // Start processing in the background without awaiting\n        console.log(`Starting background processing for job ${jobId}...`);\n        setTimeout(async ()=>{\n            try {\n                console.log(`Background processing started for job ${jobId}`);\n                // First update to processing status to indicate we've started\n                await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_2__.updateJobStatus)(jobId, \"processing\");\n                // Process the job\n                await (0,_job_processor__WEBPACK_IMPORTED_MODULE_1__.processItineraryJob)(jobId, surveyData, generatePrompt, OPENAI_API_KEY);\n                console.log(`Background processing completed successfully for job ${jobId}`);\n            } catch (error) {\n                console.error(`Background processing error for job ${jobId}:`, error);\n                // Make extra sure we update the job status on error\n                try {\n                    await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_2__.updateJobStatus)(jobId, \"failed\", {\n                        error: error.message || \"Internal server error\"\n                    });\n                } catch (updateError) {\n                    console.error(`Failed to update job status after error for ${jobId}:`, updateError);\n                }\n            }\n        }, 100); // Small delay to ensure job is created first\n        // Return immediately with the job ID\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            jobId,\n            status: \"queued\",\n            message: \"Your itinerary is being generated. Poll the job-status endpoint for updates.\"\n        });\n    } catch (error) {\n        console.error(\"Error initiating itinerary generation:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: `Failed to initiate itinerary generation: ${error.message || \"Unknown error\"}`\n        }, {\n            status: 500\n        });\n    }\n}\n// Function to generate a prompt based on survey data\nfunction generatePrompt(surveyData) {\n    // Calculate trip duration - adding 1 to include both start and end date\n    const startDate = new Date(surveyData.startDate);\n    const endDate = new Date(surveyData.endDate);\n    // Set time to noon to avoid timezone issues\n    startDate.setHours(12, 0, 0, 0);\n    endDate.setHours(12, 0, 0, 0);\n    // Calculate days including both start and end date\n    // Using Math.floor instead of Math.round and adding 1 to include both start and end date\n    const diffTime = endDate.getTime() - startDate.getTime();\n    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\n    const durationDays = diffDays + 1; // Add 1 to include both start and end date\n    console.log(\"Date calculation:\", {\n        startDate: surveyData.startDate,\n        endDate: surveyData.endDate,\n        startTimestamp: startDate.getTime(),\n        endTimestamp: endDate.getTime(),\n        diffTime,\n        diffDays,\n        durationDays\n    });\n    // Format preferences\n    const preferencesText = surveyData.preferences.length > 0 ? `They particularly enjoy ${surveyData.preferences.join(\", \")}.` : \"\";\n    // Format budget level\n    let budgetLevel = \"\";\n    switch(surveyData.budget){\n        case \"budget\":\n            budgetLevel = \"budget-friendly options, looking for economical accommodations, affordable dining, and free or low-cost activities\";\n            break;\n        case \"moderate\":\n            budgetLevel = \"mid-range options, with comfortable accommodations, good quality restaurants, and a mix of paid and free activities\";\n            break;\n        case \"luxury\":\n            budgetLevel = \"high-end options, with luxury accommodations, fine dining, and premium experiences\";\n            break;\n        default:\n            budgetLevel = \"a mix of affordable and premium options\";\n    }\n    // Format trip purpose\n    let purposeText = \"\";\n    switch(surveyData.purpose){\n        case \"vacation\":\n            purposeText = \"a relaxing vacation\";\n            break;\n        case \"honeymoon\":\n            purposeText = \"their honeymoon, so include romantic activities and settings\";\n            break;\n        case \"family\":\n            purposeText = \"a family trip, so include family-friendly activities\";\n            break;\n        case \"solo\":\n            purposeText = \"a solo adventure, with opportunities for both exploration and meeting people\";\n            break;\n        case \"business\":\n            purposeText = \"a business trip with some leisure time\";\n            break;\n        case \"weekend\":\n            purposeText = \"a quick weekend getaway\";\n            break;\n        case \"roadtrip\":\n            purposeText = \"a road trip, including notable stops and routes\";\n            break;\n        default:\n            purposeText = \"a vacation\";\n    }\n    // Construct the prompt\n    const prompt = `\nCreate a detailed ${durationDays}-day travel itinerary for a trip to ${surveyData.destination} from ${formatDate(startDate)} to ${formatDate(endDate)}.\n\nThis trip is for ${purposeText}. ${preferencesText} The traveler is looking for ${budgetLevel}.\n\nIMPORTANT: You MUST create exactly ${durationDays} days in the itinerary, with dates from ${surveyData.startDate} to ${surveyData.endDate} inclusive.\n\nFor each day, provide:\n1. Morning activity or attraction with: name, description, location, approximate cost\n2. Lunch recommendation with: restaurant name, cuisine type, price range\n3. Afternoon activity or attraction with: name, description, location, approximate cost\n4. Dinner recommendation with: restaurant name, cuisine type, price range\n5. Evening activity (if applicable) with: name, description, location, approximate cost\n\nAlso include:\n- Recommended accommodation options with estimated nightly rates\n- Transportation suggestions within the destination\n- Total estimated budget breakdown for accommodation, food, activities, and transport\n\nReturn this as a JSON object exactly as shown below. Do not include any markdown formatting, code blocks, or additional text. Use ONLY double quotes for all property names and string values - never use single quotes.\n\n{\n  \"title\": \"Trip title\",\n  \"destination\": \"Destination name\",\n  \"dates\": {\n    \"start\": \"YYYY-MM-DD\",\n    \"end\": \"YYYY-MM-DD\"\n  },\n  \"days\": [\n    {\n      \"date\": \"YYYY-MM-DD\",\n      \"activities\": [\n        {\n          \"id\": \"unique-id\",\n          \"time\": \"Morning/Afternoon/Evening\",\n          \"title\": \"Activity name\",\n          \"description\": \"Detailed description\",\n          \"location\": \"Address or area\",\n          \"coordinates\": { \"lat\": 41.3851, \"lng\": 2.1734 },\n          \"cost\": 0\n        }\n      ]\n    }\n  ],\n  \"accommodation\": [\n    {\n      \"name\": \"Accommodation name\",\n      \"description\": \"Description\",\n      \"location\": \"Address\",\n      \"pricePerNight\": 0\n    }\n  ],\n  \"transportation\": [\n    {\n      \"type\": \"Type of transport\",\n      \"description\": \"Description\",\n      \"estimatedCost\": 0\n    }\n  ],\n  \"budget\": {\n    \"accommodation\": 0,\n    \"food\": 0,\n    \"activities\": 0,\n    \"transport\": 0,\n    \"total\": 0\n  }\n}\n\nEnsure all costs are in USD and are realistic estimates. For coordinates, use approximate latitude and longitude for each location. Remember to provide a properly formatted JSON response with all property names in double quotes.\n`;\n    return prompt;\n}\n// Helper function to format dates\nfunction formatDate(date) {\n    return date.toLocaleDateString(\"en-US\", {\n        weekday: \"long\",\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\"\n    });\n}\n// Create mock itinerary data for development\nfunction createMockItinerary(surveyData) {\n    const startDate = new Date(surveyData.startDate);\n    const endDate = new Date(surveyData.endDate);\n    // Set time to noon to avoid timezone issues\n    startDate.setHours(12, 0, 0, 0);\n    endDate.setHours(12, 0, 0, 0);\n    // Calculate days including both start and end date\n    // Using Math.floor instead of Math.round and adding 1 to include both start and end date\n    const diffTime = endDate.getTime() - startDate.getTime();\n    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\n    const durationDays = diffDays + 1; // Add 1 to include both start and end date\n    console.log(\"Mock Date calculation:\", {\n        startDate: surveyData.startDate,\n        endDate: surveyData.endDate,\n        diffTime,\n        diffDays,\n        durationDays\n    });\n    const days = [];\n    // Generate mock days\n    for(let i = 0; i < durationDays; i++){\n        const currentDate = new Date(startDate);\n        currentDate.setDate(startDate.getDate() + i);\n        days.push({\n            date: currentDate.toISOString().split(\"T\")[0],\n            activities: [\n                {\n                    id: `act-${i}-1`,\n                    time: \"Morning\",\n                    title: `Explore ${surveyData.destination} - Day ${i + 1} Morning`,\n                    description: \"Start your day with a visit to a popular local attraction.\",\n                    location: `${surveyData.destination} City Center`,\n                    coordinates: {\n                        lat: 40.7128,\n                        lng: -74.0060\n                    },\n                    cost: 25\n                },\n                {\n                    id: `act-${i}-2`,\n                    time: \"Afternoon\",\n                    title: `${surveyData.destination} Afternoon Activity`,\n                    description: \"Enjoy a relaxing afternoon activity based on your preferences.\",\n                    location: `${surveyData.destination} Park`,\n                    coordinates: {\n                        lat: 40.7828,\n                        lng: -73.9654\n                    },\n                    cost: 15\n                },\n                {\n                    id: `act-${i}-3`,\n                    time: \"Evening\",\n                    title: `${surveyData.destination} Night Experience`,\n                    description: \"Experience the local nightlife and culture.\",\n                    location: `${surveyData.destination} Entertainment District`,\n                    coordinates: {\n                        lat: 40.7590,\n                        lng: -73.9845\n                    },\n                    cost: 50\n                }\n            ]\n        });\n    }\n    // Create mock budget based on preferences\n    let accommodationCost = 0;\n    switch(surveyData.budget){\n        case \"budget\":\n            accommodationCost = 75;\n            break;\n        case \"moderate\":\n            accommodationCost = 150;\n            break;\n        case \"luxury\":\n            accommodationCost = 300;\n            break;\n        default:\n            accommodationCost = 150;\n    }\n    const totalAccommodation = accommodationCost * durationDays;\n    const totalFood = 60 * durationDays;\n    const totalActivities = 90 * durationDays;\n    const totalTransport = 30 * durationDays;\n    return {\n        title: `${surveyData.destination} ${surveyData.purpose.charAt(0).toUpperCase() + surveyData.purpose.slice(1)} Trip`,\n        destination: surveyData.destination,\n        dates: {\n            start: surveyData.startDate,\n            end: surveyData.endDate\n        },\n        days,\n        accommodation: [\n            {\n                name: `${surveyData.destination} Hotel`,\n                description: \"A comfortable hotel in a convenient location.\",\n                location: `Central ${surveyData.destination}`,\n                pricePerNight: accommodationCost\n            },\n            {\n                name: `${surveyData.destination} Boutique Stay`,\n                description: \"A charming boutique accommodation with local character.\",\n                location: `Historic District, ${surveyData.destination}`,\n                pricePerNight: accommodationCost * 1.2\n            }\n        ],\n        transportation: [\n            {\n                type: \"Public Transit\",\n                description: \"Convenient and affordable public transportation network.\",\n                estimatedCost: totalTransport * 0.5\n            },\n            {\n                type: \"Taxi/Rideshare\",\n                description: \"On-demand rides for convenience.\",\n                estimatedCost: totalTransport * 0.5\n            }\n        ],\n        budget: {\n            accommodation: totalAccommodation,\n            food: totalFood,\n            activities: totalActivities,\n            transport: totalTransport,\n            total: totalAccommodation + totalFood + totalActivities + totalTransport\n        }\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2dlbmVyYXRlLWl0aW5lcmFyeS9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBMkM7QUFDMkI7QUFDTztBQUU3RSw0Q0FBNEM7QUFDckMsTUFBTU0sVUFBVSxTQUFTO0FBQ3pCLE1BQU1DLGNBQWMsR0FBRyxDQUFDLGlDQUFpQztBQUVoRSx5Q0FBeUM7QUFDekMsTUFBTUMsaUJBQWlCQyxRQUFRQyxHQUFHLENBQUNGLGNBQWMsSUFBSTtBQUVyRCw2Q0FBNkM7QUFDN0MsTUFBTUcsZUFBZUYsa0JBQXlCO0FBRTlDLDJDQUEyQztBQUMzQyxNQUFNRyx1QkFBdUJDLFFBQzNCSixLQUFvQyxJQUNwQ0Esa05BQXlDO0FBYXBDLGVBQWVPLEtBQUtDLE9BQWdCO0lBQ3pDLElBQUk7UUFDRiw2REFBNkQ7UUFDN0RDLFFBQVFDLEdBQUcsQ0FBQyw4QkFBOEI7WUFDeENDLGdCQUFnQixDQUFDLENBQUNYLDBDQUFvQztZQUN0RFksZ0JBQWdCLENBQUMsQ0FBQ1osa05BQXlDO1lBQzNEYSxXQUFXYiwwQ0FBb0MsRUFBRWMsVUFBVTtZQUMzREMsV0FBV2Ysa05BQXlDLEVBQUVjLFVBQVU7UUFDbEU7UUFFQSx1REFBdUQ7UUFDdkQsSUFBSVgsc0JBQXNCO1lBQ3hCLElBQUk7Z0JBQ0YsTUFBTSxFQUFFYSxJQUFJLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1yQixtREFBUUEsQ0FBQ3NCLElBQUksQ0FBQyxRQUFRQyxNQUFNLENBQUMsU0FBU0MsS0FBSyxDQUFDO2dCQUMxRSxJQUFJSCxPQUFPO29CQUNUUixRQUFRUSxLQUFLLENBQUMsb0NBQW9DO3dCQUNoREksU0FBU0osTUFBTUksT0FBTzt3QkFDdEJDLE1BQU1MLE1BQU1LLElBQUksSUFBSTt3QkFDcEJDLE1BQU1OLE1BQU1NLElBQUksSUFBSTtvQkFDdEI7Z0JBQ0EsOENBQThDO2dCQUM5QyxtQ0FBbUM7Z0JBQ3JDLE9BQU87b0JBQ0xkLFFBQVFDLEdBQUcsQ0FBQyx3Q0FBd0NNO2dC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QnVELEtBQUt0RSxXQUFXaUIsT0FBTztRQUN6QjtRQUNBeUI7UUFDQTZCLGVBQWU7WUFDYjtnQkFDRUMsTUFBTSxDQUFDLEVBQUV4RSxXQUFXa0MsV0FBVyxDQUFDLE1BQU0sQ0FBQztnQkFDdkNvQixhQUFhO2dCQUNiQyxVQUFVLENBQUMsUUFBUSxFQUFFdkQsV0FBV2tDLFdBQVcsQ0FBQyxDQUFDO2dCQUM3Q3VDLGVBQWViO1lBQ2pCO1lBQ0E7Z0JBQ0VZLE1BQU0sQ0FBQyxFQUFFeEUsV0FBV2tDLFdBQVcsQ0FBQyxjQUFjLENBQUM7Z0JBQy9Db0IsYUFBYTtnQkFDYkMsVUFBVSxDQUFDLG1CQUFtQixFQUFFdkQsV0FBV2tDLFdBQVcsQ0FBQyxDQUFDO2dCQUN4RHVDLGVBQWViLG9CQUFvQjtZQUNyQztTQUNEO1FBQ0RjLGdCQUFnQjtZQUNkO2dCQUNFQyxNQUFNO2dCQUNOckIsYUFBYTtnQkFDYnNCLGVBQWVaLGlCQUFpQjtZQUNsQztZQUNBO2dCQUNFVyxNQUFNO2dCQUNOckIsYUFBYTtnQkFDYnNCLGVBQWVaLGlCQUFpQjtZQUNsQztTQUNEO1FBQ0RqQyxRQUFRO1lBQ053QyxlQUFlVjtZQUNmZ0IsTUFBTWY7WUFDTlosWUFBWWE7WUFDWmUsV0FBV2Q7WUFDWGUsT0FBT2xCLHFCQUFxQkMsWUFBWUMsa0JBQWtCQztRQUM1RDtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9haS10cmF2ZWwtYWdlbnQvLi9hcHAvYXBpL2dlbmVyYXRlLWl0aW5lcmFyeS9yb3V0ZS50cz9kODMzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IGdlbmVyYXRlSm9iSWQsIHByb2Nlc3NJdGluZXJhcnlKb2IgfSBmcm9tICcuLi9qb2ItcHJvY2Vzc29yJztcbmltcG9ydCB7IGNyZWF0ZUpvYiwgdXBkYXRlSm9iU3RhdHVzLCBzdXBhYmFzZSB9IGZyb20gJy4uLy4uLy4uL2xpYi9zdXBhYmFzZSc7XG5cbi8vIENvbmZpZ3VyZSBydW50aW1lIGZvciBzZXJ2ZXJsZXNzIGZ1bmN0aW9uXG5leHBvcnQgY29uc3QgcnVudGltZSA9ICdub2RlanMnO1xuZXhwb3J0IGNvbnN0IG1heER1cmF0aW9uID0gNjA7IC8vIFNldCBtYXggZHVyYXRpb24gdG8gNjAgc2Vjb25kc1xuXG4vLyBVc2UgQVBJIGtleSBmcm9tIGVudmlyb25tZW50IHZhcmlhYmxlc1xuY29uc3QgT1BFTkFJX0FQSV9LRVkgPSBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSB8fCAnJztcblxuLy8gQ2hlY2sgaWYgcnVubmluZyBpbiBwcm9kdWN0aW9uIGVudmlyb25tZW50XG5jb25zdCBpc1Byb2R1Y3Rpb24gPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nO1xuXG4vLyBDaGVjayBpZiBTdXBhYmFzZSBpcyBwcm9wZXJseSBjb25maWd1cmVkXG5jb25zdCBpc1N1cGFiYXNlQ29uZmlndXJlZCA9IEJvb2xlYW4oXG4gIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCAmJiBcbiAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVlcbik7XG5cbi8vIFN1cnZleSBkYXRhIHR5cGVcbnR5cGUgU3VydmV5RGF0YSA9IHtcbiAgZGVzdGluYXRpb246IHN0cmluZztcbiAgc3RhcnREYXRlOiBzdHJpbmc7XG4gIGVuZERhdGU6IHN0cmluZztcbiAgcHVycG9zZTogc3RyaW5nO1xuICBidWRnZXQ6IHN0cmluZztcbiAgcHJlZmVyZW5jZXM6IHN0cmluZ1tdO1xufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogUmVxdWVzdCkge1xuICB0cnkge1xuICAgIC8vIExvZyBlbnZpcm9ubWVudCB2YXJpYWJsZXMgKHdpdGhvdXQgZXhwb3NpbmcgYWN0dWFsIHZhbHVlcylcbiAgICBjb25zb2xlLmxvZygnU3VwYWJhc2UgY29ubmVjdGlvbiBjaGVjazonLCB7XG4gICAgICBoYXNTdXBhYmFzZVVybDogISFwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwsXG4gICAgICBoYXNTdXBhYmFzZUtleTogISFwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSxcbiAgICAgIHVybExlbmd0aDogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMPy5sZW5ndGggfHwgMCxcbiAgICAgIGtleUxlbmd0aDogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVk/Lmxlbmd0aCB8fCAwXG4gICAgfSk7XG5cbiAgICAvLyBPbmx5IHRlc3QgU3VwYWJhc2UgY29ubmVjdGlvbiBpZiBwcm9wZXJseSBjb25maWd1cmVkXG4gICAgaWYgKGlzU3VwYWJhc2VDb25maWd1cmVkKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdqb2JzJykuc2VsZWN0KCdjb3VudCcpLmxpbWl0KDEpO1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdTdXBhYmFzZSBjb25uZWN0aW9uIHRlc3QgZmFpbGVkOicsIHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgICBoaW50OiBlcnJvci5oaW50IHx8ICcnLFxuICAgICAgICAgICAgY29kZTogZXJyb3IuY29kZSB8fCAnJ1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIC8vIENvbnRpbnVlIGV4ZWN1dGlvbiBkZXNwaXRlIGNvbm5lY3Rpb24gZXJyb3JcbiAgICAgICAgICAvLyBUaGUgam9iIHdpbGwgYmUgc3RvcmVkIGluIG1lbW9yeVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdTdXBhYmFzZSBjb25uZWN0aW9uIHRlc3Qgc3VjY2Vzc2Z1bDonLCBkYXRhKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoY29ubkVycm9yOiBhbnkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignU3VwYWJhc2UgY29ubmVjdGlvbiB0ZXN0IGV4Y2VwdGlvbjonLCB7XG4gICAgICAgICAgbWVzc2FnZTogY29ubkVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgZGV0YWlsczogY29ubkVycm9yLnRvU3RyaW5nKCksXG4gICAgICAgICAgaGludDogJycsXG4gICAgICAgICAgY29kZTogJydcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIENvbnRpbnVlIGV4ZWN1dGlvbiBkZXNwaXRlIGNvbm5lY3Rpb24gZXJyb3JcbiAgICAgICAgLy8gVGhlIGpvYiB3aWxsIGJlIHN0b3JlZCBpbiBtZW1vcnlcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coJ1NraXBwaW5nIFN1cGFiYXNlIGNvbm5lY3Rpb24gdGVzdCAtIG5vdCBjb25maWd1cmVkJyk7XG4gICAgfVxuXG4gICAgLy8gUGFyc2UgdGhlIHJlcXVlc3QgYm9keVxuICAgIGNvbnN0IHN1cnZleURhdGE6IFN1cnZleURhdGEgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcblxuICAgIC8vIENyZWF0ZSBhIHVuaXF1ZSBqb2IgSURcbiAgICBjb25zdCBqb2JJZCA9IGdlbmVyYXRlSm9iSWQoKTtcblxuICAgIC8vIElmIHdlJ3JlIGluIGRldmVsb3BtZW50IG9yIHRlc3RpbmcsIHJldHVybiBtb2NrIGRhdGEgaW1tZWRpYXRlbHlcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgJiYgIU9QRU5BSV9BUElfS0VZLnN0YXJ0c1dpdGgoJ3NrLScpKSB7XG4gICAgICBjb25zb2xlLmxvZygnRGV2ZWxvcG1lbnQgbW9kZTogUmV0dXJuaW5nIG1vY2sgZGF0YScpO1xuICAgICAgY29uc3QgbW9ja0l0aW5lcmFyeSA9IGNyZWF0ZU1vY2tJdGluZXJhcnkoc3VydmV5RGF0YSk7XG4gICAgICBjb25zdCB1cGRhdGVSZXN1bHQgPSBhd2FpdCB1cGRhdGVKb2JTdGF0dXMoam9iSWQsICdjb21wbGV0ZWQnLCB7IFxuICAgICAgICByZXN1bHQ6IHsgXG4gICAgICAgICAgaXRpbmVyYXJ5OiBtb2NrSXRpbmVyYXJ5LCBcbiAgICAgICAgICBwcm9tcHQ6IGdlbmVyYXRlUHJvbXB0KHN1cnZleURhdGEpIFxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgaWYgKCF1cGRhdGVSZXN1bHQpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHVwZGF0ZSBqb2Igc3RhdHVzIGluIGRldmVsb3BtZW50IG1vZGUnKTtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gdXBkYXRlIGpvYiBzdGF0dXMnIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGpvYklkLCBzdGF0dXM6ICdjb21wbGV0ZWQnIH0pO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBhIG5ldyBqb2JcbiAgICBjb25zb2xlLmxvZygnQ3JlYXRpbmcgbmV3IGpvYiB3aXRoIElEOicsIGpvYklkKTtcbiAgICBjb25zdCBqb2JDcmVhdGVkID0gYXdhaXQgY3JlYXRlSm9iKGpvYklkKTtcbiAgICBcbiAgICBpZiAoIWpvYkNyZWF0ZWQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjcmVhdGUgam9iJyk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIGpvYiBpbiBkYXRhYmFzZScgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIFN0YXJ0IHByb2Nlc3NpbmcgaW4gdGhlIGJhY2tncm91bmQgd2l0aG91dCBhd2FpdGluZ1xuICAgIGNvbnNvbGUubG9nKGBTdGFydGluZyBiYWNrZ3JvdW5kIHByb2Nlc3NpbmcgZm9yIGpvYiAke2pvYklkfS4uLmApO1xuICAgIHNldFRpbWVvdXQoYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc29sZS5sb2coYEJhY2tncm91bmQgcHJvY2Vzc2luZyBzdGFydGVkIGZvciBqb2IgJHtqb2JJZH1gKTtcbiAgICAgICAgLy8gRmlyc3QgdXBkYXRlIHRvIHByb2Nlc3Npbmcgc3RhdHVzIHRvIGluZGljYXRlIHdlJ3ZlIHN0YXJ0ZWRcbiAgICAgICAgYXdhaXQgdXBkYXRlSm9iU3RhdHVzKGpvYklkLCAncHJvY2Vzc2luZycpO1xuICAgICAgICBcbiAgICAgICAgLy8gUHJvY2VzcyB0aGUgam9iXG4gICAgICAgIGF3YWl0IHByb2Nlc3NJdGluZXJhcnlKb2Ioam9iSWQsIHN1cnZleURhdGEsIGdlbmVyYXRlUHJvbXB0LCBPUEVOQUlfQVBJX0tFWSk7XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZyhgQmFja2dyb3VuZCBwcm9jZXNzaW5nIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkgZm9yIGpvYiAke2pvYklkfWApO1xuICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBCYWNrZ3JvdW5kIHByb2Nlc3NpbmcgZXJyb3IgZm9yIGpvYiAke2pvYklkfTpgLCBlcnJvcik7XG4gICAgICAgIC8vIE1ha2UgZXh0cmEgc3VyZSB3ZSB1cGRhdGUgdGhlIGpvYiBzdGF0dXMgb24gZXJyb3JcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCB1cGRhdGVKb2JTdGF0dXMoam9iSWQsICdmYWlsZWQnLCB7IFxuICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfHwgJ0ludGVybmFsIHNlcnZlciBlcnJvcidcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAodXBkYXRlRXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gdXBkYXRlIGpvYiBzdGF0dXMgYWZ0ZXIgZXJyb3IgZm9yICR7am9iSWR9OmAsIHVwZGF0ZUVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sIDEwMCk7IC8vIFNtYWxsIGRlbGF5IHRvIGVuc3VyZSBqb2IgaXMgY3JlYXRlZCBmaXJzdFxuXG4gICAgLy8gUmV0dXJuIGltbWVkaWF0ZWx5IHdpdGggdGhlIGpvYiBJRFxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IFxuICAgICAgam9iSWQsIFxuICAgICAgc3RhdHVzOiAncXVldWVkJyxcbiAgICAgIG1lc3NhZ2U6ICdZb3VyIGl0aW5lcmFyeSBpcyBiZWluZyBnZW5lcmF0ZWQuIFBvbGwgdGhlIGpvYi1zdGF0dXMgZW5kcG9pbnQgZm9yIHVwZGF0ZXMuJ1xuICAgIH0pO1xuICAgIFxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW5pdGlhdGluZyBpdGluZXJhcnkgZ2VuZXJhdGlvbjonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogYEZhaWxlZCB0byBpbml0aWF0ZSBpdGluZXJhcnkgZ2VuZXJhdGlvbjogJHtlcnJvci5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJ31gIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG5cbi8vIEZ1bmN0aW9uIHRvIGdlbmVyYXRlIGEgcHJvbXB0IGJhc2VkIG9uIHN1cnZleSBkYXRhXG5mdW5jdGlvbiBnZW5lcmF0ZVByb21wdChzdXJ2ZXlEYXRhOiBTdXJ2ZXlEYXRhKTogc3RyaW5nIHtcbiAgLy8gQ2FsY3VsYXRlIHRyaXAgZHVyYXRpb24gLSBhZGRpbmcgMSB0byBpbmNsdWRlIGJvdGggc3RhcnQgYW5kIGVuZCBkYXRlXG4gIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKHN1cnZleURhdGEuc3RhcnREYXRlKTtcbiAgY29uc3QgZW5kRGF0ZSA9IG5ldyBEYXRlKHN1cnZleURhdGEuZW5kRGF0ZSk7XG4gIFxuICAvLyBTZXQgdGltZSB0byBub29uIHRvIGF2b2lkIHRpbWV6b25lIGlzc3Vlc1xuICBzdGFydERhdGUuc2V0SG91cnMoMTIsIDAsIDAsIDApO1xuICBlbmREYXRlLnNldEhvdXJzKDEyLCAwLCAwLCAwKTtcbiAgXG4gIC8vIENhbGN1bGF0ZSBkYXlzIGluY2x1ZGluZyBib3RoIHN0YXJ0IGFuZCBlbmQgZGF0ZVxuICAvLyBVc2luZyBNYXRoLmZsb29yIGluc3RlYWQgb2YgTWF0aC5yb3VuZCBhbmQgYWRkaW5nIDEgdG8gaW5jbHVkZSBib3RoIHN0YXJ0IGFuZCBlbmQgZGF0ZVxuICBjb25zdCBkaWZmVGltZSA9IGVuZERhdGUuZ2V0VGltZSgpIC0gc3RhcnREYXRlLmdldFRpbWUoKTtcbiAgY29uc3QgZGlmZkRheXMgPSBNYXRoLmZsb29yKGRpZmZUaW1lIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpKTtcbiAgY29uc3QgZHVyYXRpb25EYXlzID0gZGlmZkRheXMgKyAxOyAvLyBBZGQgMSB0byBpbmNsdWRlIGJvdGggc3RhcnQgYW5kIGVuZCBkYXRlXG4gIFxuICBjb25zb2xlLmxvZygnRGF0ZSBjYWxjdWxhdGlvbjonLCB7XG4gICAgc3RhcnREYXRlOiBzdXJ2ZXlEYXRhLnN0YXJ0RGF0ZSxcbiAgICBlbmREYXRlOiBzdXJ2ZXlEYXRhLmVuZERhdGUsXG4gICAgc3RhcnRUaW1lc3RhbXA6IHN0YXJ0RGF0ZS5nZXRUaW1lKCksXG4gICAgZW5kVGltZXN0YW1wOiBlbmREYXRlLmdldFRpbWUoKSxcbiAgICBkaWZmVGltZSxcbiAgICBkaWZmRGF5cyxcbiAgICBkdXJhdGlvbkRheXNcbiAgfSk7XG5cbiAgLy8gRm9ybWF0IHByZWZlcmVuY2VzXG4gIGNvbnN0IHByZWZlcmVuY2VzVGV4dCA9IHN1cnZleURhdGEucHJlZmVyZW5jZXMubGVuZ3RoID4gMFxuICAgID8gYFRoZXkgcGFydGljdWxhcmx5IGVuam95ICR7c3VydmV5RGF0YS5wcmVmZXJlbmNlcy5qb2luKCcsICcpfS5gXG4gICAgOiAnJztcblxuICAvLyBGb3JtYXQgYnVkZ2V0IGxldmVsXG4gIGxldCBidWRnZXRMZXZlbCA9ICcnO1xuICBzd2l0Y2ggKHN1cnZleURhdGEuYnVkZ2V0KSB7XG4gICAgY2FzZSAnYnVkZ2V0JzpcbiAgICAgIGJ1ZGdldExldmVsID0gJ2J1ZGdldC1mcmllbmRseSBvcHRpb25zLCBsb29raW5nIGZvciBlY29ub21pY2FsIGFjY29tbW9kYXRpb25zLCBhZmZvcmRhYmxlIGRpbmluZywgYW5kIGZyZWUgb3IgbG93LWNvc3QgYWN0aXZpdGllcyc7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdtb2RlcmF0ZSc6XG4gICAgICBidWRnZXRMZXZlbCA9ICdtaWQtcmFuZ2Ugb3B0aW9ucywgd2l0aCBjb21mb3J0YWJsZSBhY2NvbW1vZGF0aW9ucywgZ29vZCBxdWFsaXR5IHJlc3RhdXJhbnRzLCBhbmQgYSBtaXggb2YgcGFpZCBhbmQgZnJlZSBhY3Rpdml0aWVzJztcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2x1eHVyeSc6XG4gICAgICBidWRnZXRMZXZlbCA9ICdoaWdoLWVuZCBvcHRpb25zLCB3aXRoIGx1eHVyeSBhY2NvbW1vZGF0aW9ucywgZmluZSBkaW5pbmcsIGFuZCBwcmVtaXVtIGV4cGVyaWVuY2VzJztcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICBidWRnZXRMZXZlbCA9ICdhIG1peCBvZiBhZmZvcmRhYmxlIGFuZCBwcmVtaXVtIG9wdGlvbnMnO1xuICB9XG5cbiAgLy8gRm9ybWF0IHRyaXAgcHVycG9zZVxuICBsZXQgcHVycG9zZVRleHQgPSAnJztcbiAgc3dpdGNoIChzdXJ2ZXlEYXRhLnB1cnBvc2UpIHtcbiAgICBjYXNlICd2YWNhdGlvbic6XG4gICAgICBwdXJwb3NlVGV4dCA9ICdhIHJlbGF4aW5nIHZhY2F0aW9uJztcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2hvbmV5bW9vbic6XG4gICAgICBwdXJwb3NlVGV4dCA9ICd0aGVpciBob25leW1vb24sIHNvIGluY2x1ZGUgcm9tYW50aWMgYWN0aXZpdGllcyBhbmQgc2V0dGluZ3MnO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnZmFtaWx5JzpcbiAgICAgIHB1cnBvc2VUZXh0ID0gJ2EgZmFtaWx5IHRyaXAsIHNvIGluY2x1ZGUgZmFtaWx5LWZyaWVuZGx5IGFjdGl2aXRpZXMnO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnc29sbyc6XG4gICAgICBwdXJwb3NlVGV4dCA9ICdhIHNvbG8gYWR2ZW50dXJlLCB3aXRoIG9wcG9ydHVuaXRpZXMgZm9yIGJvdGggZXhwbG9yYXRpb24gYW5kIG1lZXRpbmcgcGVvcGxlJztcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2J1c2luZXNzJzpcbiAgICAgIHB1cnBvc2VUZXh0ID0gJ2EgYnVzaW5lc3MgdHJpcCB3aXRoIHNvbWUgbGVpc3VyZSB0aW1lJztcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3dlZWtlbmQnOlxuICAgICAgcHVycG9zZVRleHQgPSAnYSBxdWljayB3ZWVrZW5kIGdldGF3YXknO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAncm9hZHRyaXAnOlxuICAgICAgcHVycG9zZVRleHQgPSAnYSByb2FkIHRyaXAsIGluY2x1ZGluZyBub3RhYmxlIHN0b3BzIGFuZCByb3V0ZXMnO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIHB1cnBvc2VUZXh0ID0gJ2EgdmFjYXRpb24nO1xuICB9XG5cbiAgLy8gQ29uc3RydWN0IHRoZSBwcm9tcHRcbiAgY29uc3QgcHJvbXB0ID0gYFxuQ3JlYXRlIGEgZGV0YWlsZWQgJHtkdXJhdGlvbkRheXN9LWRheSB0cmF2ZWwgaXRpbmVyYXJ5IGZvciBhIHRyaXAgdG8gJHtzdXJ2ZXlEYXRhLmRlc3RpbmF0aW9ufSBmcm9tICR7Zm9ybWF0RGF0ZShzdGFydERhdGUpfSB0byAke2Zvcm1hdERhdGUoZW5kRGF0ZSl9LlxuXG5UaGlzIHRyaXAgaXMgZm9yICR7cHVycG9zZVRleHR9LiAke3ByZWZlcmVuY2VzVGV4dH0gVGhlIHRyYXZlbGVyIGlzIGxvb2tpbmcgZm9yICR7YnVkZ2V0TGV2ZWx9LlxuXG5JTVBPUlRBTlQ6IFlvdSBNVVNUIGNyZWF0ZSBleGFjdGx5ICR7ZHVyYXRpb25EYXlzfSBkYXlzIGluIHRoZSBpdGluZXJhcnksIHdpdGggZGF0ZXMgZnJvbSAke3N1cnZleURhdGEuc3RhcnREYXRlfSB0byAke3N1cnZleURhdGEuZW5kRGF0ZX0gaW5jbHVzaXZlLlxuXG5Gb3IgZWFjaCBkYXksIHByb3ZpZGU6XG4xLiBNb3JuaW5nIGFjdGl2aXR5IG9yIGF0dHJhY3Rpb24gd2l0aDogbmFtZSwgZGVzY3JpcHRpb24sIGxvY2F0aW9uLCBhcHByb3hpbWF0ZSBjb3N0XG4yLiBMdW5jaCByZWNvbW1lbmRhdGlvbiB3aXRoOiByZXN0YXVyYW50IG5hbWUsIGN1aXNpbmUgdHlwZSwgcHJpY2UgcmFuZ2VcbjMuIEFmdGVybm9vbiBhY3Rpdml0eSBvciBhdHRyYWN0aW9uIHdpdGg6IG5hbWUsIGRlc2NyaXB0aW9uLCBsb2NhdGlvbiwgYXBwcm94aW1hdGUgY29zdFxuNC4gRGlubmVyIHJlY29tbWVuZGF0aW9uIHdpdGg6IHJlc3RhdXJhbnQgbmFtZSwgY3Vpc2luZSB0eXBlLCBwcmljZSByYW5nZVxuNS4gRXZlbmluZyBhY3Rpdml0eSAoaWYgYXBwbGljYWJsZSkgd2l0aDogbmFtZSwgZGVzY3JpcHRpb24sIGxvY2F0aW9uLCBhcHByb3hpbWF0ZSBjb3N0XG5cbkFsc28gaW5jbHVkZTpcbi0gUmVjb21tZW5kZWQgYWNjb21tb2RhdGlvbiBvcHRpb25zIHdpdGggZXN0aW1hdGVkIG5pZ2h0bHkgcmF0ZXNcbi0gVHJhbnNwb3J0YXRpb24gc3VnZ2VzdGlvbnMgd2l0aGluIHRoZSBkZXN0aW5hdGlvblxuLSBUb3RhbCBlc3RpbWF0ZWQgYnVkZ2V0IGJyZWFrZG93biBmb3IgYWNjb21tb2RhdGlvbiwgZm9vZCwgYWN0aXZpdGllcywgYW5kIHRyYW5zcG9ydFxuXG5SZXR1cm4gdGhpcyBhcyBhIEpTT04gb2JqZWN0IGV4YWN0bHkgYXMgc2hvd24gYmVsb3cuIERvIG5vdCBpbmNsdWRlIGFueSBtYXJrZG93biBmb3JtYXR0aW5nLCBjb2RlIGJsb2Nrcywgb3IgYWRkaXRpb25hbCB0ZXh0LiBVc2UgT05MWSBkb3VibGUgcXVvdGVzIGZvciBhbGwgcHJvcGVydHkgbmFtZXMgYW5kIHN0cmluZyB2YWx1ZXMgLSBuZXZlciB1c2Ugc2luZ2xlIHF1b3Rlcy5cblxue1xuICBcInRpdGxlXCI6IFwiVHJpcCB0aXRsZVwiLFxuICBcImRlc3RpbmF0aW9uXCI6IFwiRGVzdGluYXRpb24gbmFtZVwiLFxuICBcImRhdGVzXCI6IHtcbiAgICBcInN0YXJ0XCI6IFwiWVlZWS1NTS1ERFwiLFxuICAgIFwiZW5kXCI6IFwiWVlZWS1NTS1ERFwiXG4gIH0sXG4gIFwiZGF5c1wiOiBbXG4gICAge1xuICAgICAgXCJkYXRlXCI6IFwiWVlZWS1NTS1ERFwiLFxuICAgICAgXCJhY3Rpdml0aWVzXCI6IFtcbiAgICAgICAge1xuICAgICAgICAgIFwiaWRcIjogXCJ1bmlxdWUtaWRcIixcbiAgICAgICAgICBcInRpbWVcIjogXCJNb3JuaW5nL0FmdGVybm9vbi9FdmVuaW5nXCIsXG4gICAgICAgICAgXCJ0aXRsZVwiOiBcIkFjdGl2aXR5IG5hbWVcIixcbiAgICAgICAgICBcImRlc2NyaXB0aW9uXCI6IFwiRGV0YWlsZWQgZGVzY3JpcHRpb25cIixcbiAgICAgICAgICBcImxvY2F0aW9uXCI6IFwiQWRkcmVzcyBvciBhcmVhXCIsXG4gICAgICAgICAgXCJjb29yZGluYXRlc1wiOiB7IFwibGF0XCI6IDQxLjM4NTEsIFwibG5nXCI6IDIuMTczNCB9LFxuICAgICAgICAgIFwiY29zdFwiOiAwXG4gICAgICAgIH1cbiAgICAgIF1cbiAgICB9XG4gIF0sXG4gIFwiYWNjb21tb2RhdGlvblwiOiBbXG4gICAge1xuICAgICAgXCJuYW1lXCI6IFwiQWNjb21tb2RhdGlvbiBuYW1lXCIsXG4gICAgICBcImRlc2NyaXB0aW9uXCI6IFwiRGVzY3JpcHRpb25cIixcbiAgICAgIFwibG9jYXRpb25cIjogXCJBZGRyZXNzXCIsXG4gICAgICBcInByaWNlUGVyTmlnaHRcIjogMFxuICAgIH1cbiAgXSxcbiAgXCJ0cmFuc3BvcnRhdGlvblwiOiBbXG4gICAge1xuICAgICAgXCJ0eXBlXCI6IFwiVHlwZSBvZiB0cmFuc3BvcnRcIixcbiAgICAgIFwiZGVzY3JpcHRpb25cIjogXCJEZXNjcmlwdGlvblwiLFxuICAgICAgXCJlc3RpbWF0ZWRDb3N0XCI6IDBcbiAgICB9XG4gIF0sXG4gIFwiYnVkZ2V0XCI6IHtcbiAgICBcImFjY29tbW9kYXRpb25cIjogMCxcbiAgICBcImZvb2RcIjogMCxcbiAgICBcImFjdGl2aXRpZXNcIjogMCxcbiAgICBcInRyYW5zcG9ydFwiOiAwLFxuICAgIFwidG90YWxcIjogMFxuICB9XG59XG5cbkVuc3VyZSBhbGwgY29zdHMgYXJlIGluIFVTRCBhbmQgYXJlIHJlYWxpc3RpYyBlc3RpbWF0ZXMuIEZvciBjb29yZGluYXRlcywgdXNlIGFwcHJveGltYXRlIGxhdGl0dWRlIGFuZCBsb25naXR1ZGUgZm9yIGVhY2ggbG9jYXRpb24uIFJlbWVtYmVyIHRvIHByb3ZpZGUgYSBwcm9wZXJseSBmb3JtYXR0ZWQgSlNPTiByZXNwb25zZSB3aXRoIGFsbCBwcm9wZXJ0eSBuYW1lcyBpbiBkb3VibGUgcXVvdGVzLlxuYDtcblxuICByZXR1cm4gcHJvbXB0O1xufVxuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gZm9ybWF0IGRhdGVzXG5mdW5jdGlvbiBmb3JtYXREYXRlKGRhdGU6IERhdGUpOiBzdHJpbmcge1xuICByZXR1cm4gZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLVVTJywgeyBcbiAgICB3ZWVrZGF5OiAnbG9uZycsIFxuICAgIHllYXI6ICdudW1lcmljJywgXG4gICAgbW9udGg6ICdsb25nJywgXG4gICAgZGF5OiAnbnVtZXJpYycgXG4gIH0pO1xufVxuXG4vLyBDcmVhdGUgbW9jayBpdGluZXJhcnkgZGF0YSBmb3IgZGV2ZWxvcG1lbnRcbmZ1bmN0aW9uIGNyZWF0ZU1vY2tJdGluZXJhcnkoc3VydmV5RGF0YTogU3VydmV5RGF0YSk6IGFueSB7XG4gIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKHN1cnZleURhdGEuc3RhcnREYXRlKTtcbiAgY29uc3QgZW5kRGF0ZSA9IG5ldyBEYXRlKHN1cnZleURhdGEuZW5kRGF0ZSk7XG4gIFxuICAvLyBTZXQgdGltZSB0byBub29uIHRvIGF2b2lkIHRpbWV6b25lIGlzc3Vlc1xuICBzdGFydERhdGUuc2V0SG91cnMoMTIsIDAsIDAsIDApO1xuICBlbmREYXRlLnNldEhvdXJzKDEyLCAwLCAwLCAwKTtcbiAgXG4gIC8vIENhbGN1bGF0ZSBkYXlzIGluY2x1ZGluZyBib3RoIHN0YXJ0IGFuZCBlbmQgZGF0ZVxuICAvLyBVc2luZyBNYXRoLmZsb29yIGluc3RlYWQgb2YgTWF0aC5yb3VuZCBhbmQgYWRkaW5nIDEgdG8gaW5jbHVkZSBib3RoIHN0YXJ0IGFuZCBlbmQgZGF0ZVxuICBjb25zdCBkaWZmVGltZSA9IGVuZERhdGUuZ2V0VGltZSgpIC0gc3RhcnREYXRlLmdldFRpbWUoKTtcbiAgY29uc3QgZGlmZkRheXMgPSBNYXRoLmZsb29yKGRpZmZUaW1lIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpKTtcbiAgY29uc3QgZHVyYXRpb25EYXlzID0gZGlmZkRheXMgKyAxOyAvLyBBZGQgMSB0byBpbmNsdWRlIGJvdGggc3RhcnQgYW5kIGVuZCBkYXRlXG4gIFxuICBjb25zb2xlLmxvZygnTW9jayBEYXRlIGNhbGN1bGF0aW9uOicsIHtcbiAgICBzdGFydERhdGU6IHN1cnZleURhdGEuc3RhcnREYXRlLFxuICAgIGVuZERhdGU6IHN1cnZleURhdGEuZW5kRGF0ZSxcbiAgICBkaWZmVGltZSxcbiAgICBkaWZmRGF5cyxcbiAgICBkdXJhdGlvbkRheXNcbiAgfSk7XG4gIFxuICBjb25zdCBkYXlzID0gW107XG4gIFxuICAvLyBHZW5lcmF0ZSBtb2NrIGRheXNcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBkdXJhdGlvbkRheXM7IGkrKykge1xuICAgIGNvbnN0IGN1cnJlbnREYXRlID0gbmV3IERhdGUoc3RhcnREYXRlKTtcbiAgICBjdXJyZW50RGF0ZS5zZXREYXRlKHN0YXJ0RGF0ZS5nZXREYXRlKCkgKyBpKTtcbiAgICBcbiAgICBkYXlzLnB1c2goe1xuICAgICAgZGF0ZTogY3VycmVudERhdGUudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdLFxuICAgICAgYWN0aXZpdGllczogW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6IGBhY3QtJHtpfS0xYCxcbiAgICAgICAgICB0aW1lOiAnTW9ybmluZycsXG4gICAgICAgICAgdGl0bGU6IGBFeHBsb3JlICR7c3VydmV5RGF0YS5kZXN0aW5hdGlvbn0gLSBEYXkgJHtpICsgMX0gTW9ybmluZ2AsXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdTdGFydCB5b3VyIGRheSB3aXRoIGEgdmlzaXQgdG8gYSBwb3B1bGFyIGxvY2FsIGF0dHJhY3Rpb24uJyxcbiAgICAgICAgICBsb2NhdGlvbjogYCR7c3VydmV5RGF0YS5kZXN0aW5hdGlvbn0gQ2l0eSBDZW50ZXJgLFxuICAgICAgICAgIGNvb3JkaW5hdGVzOiB7IGxhdDogNDAuNzEyOCwgbG5nOiAtNzQuMDA2MCB9LCAvLyBOWUMgY29vcmRpbmF0ZXMgYXMgcGxhY2Vob2xkZXJcbiAgICAgICAgICBjb3N0OiAyNSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiBgYWN0LSR7aX0tMmAsXG4gICAgICAgICAgdGltZTogJ0FmdGVybm9vbicsXG4gICAgICAgICAgdGl0bGU6IGAke3N1cnZleURhdGEuZGVzdGluYXRpb259IEFmdGVybm9vbiBBY3Rpdml0eWAsXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdFbmpveSBhIHJlbGF4aW5nIGFmdGVybm9vbiBhY3Rpdml0eSBiYXNlZCBvbiB5b3VyIHByZWZlcmVuY2VzLicsXG4gICAgICAgICAgbG9jYXRpb246IGAke3N1cnZleURhdGEuZGVzdGluYXRpb259IFBhcmtgLFxuICAgICAgICAgIGNvb3JkaW5hdGVzOiB7IGxhdDogNDAuNzgyOCwgbG5nOiAtNzMuOTY1NCB9LCAvLyBDZW50cmFsIFBhcmsgY29vcmRpbmF0ZXMgYXMgcGxhY2Vob2xkZXJcbiAgICAgICAgICBjb3N0OiAxNSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiBgYWN0LSR7aX0tM2AsXG4gICAgICAgICAgdGltZTogJ0V2ZW5pbmcnLFxuICAgICAgICAgIHRpdGxlOiBgJHtzdXJ2ZXlEYXRhLmRlc3RpbmF0aW9ufSBOaWdodCBFeHBlcmllbmNlYCxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ0V4cGVyaWVuY2UgdGhlIGxvY2FsIG5pZ2h0bGlmZSBhbmQgY3VsdHVyZS4nLFxuICAgICAgICAgIGxvY2F0aW9uOiBgJHtzdXJ2ZXlEYXRhLmRlc3RpbmF0aW9ufSBFbnRlcnRhaW5tZW50IERpc3RyaWN0YCxcbiAgICAgICAgICBjb29yZGluYXRlczogeyBsYXQ6IDQwLjc1OTAsIGxuZzogLTczLjk4NDUgfSwgLy8gVGltZXMgU3F1YXJlIGNvb3JkaW5hdGVzIGFzIHBsYWNlaG9sZGVyXG4gICAgICAgICAgY29zdDogNTAsXG4gICAgICAgIH0sXG4gICAgICBdXG4gICAgfSk7XG4gIH1cbiAgXG4gIC8vIENyZWF0ZSBtb2NrIGJ1ZGdldCBiYXNlZCBvbiBwcmVmZXJlbmNlc1xuICBsZXQgYWNjb21tb2RhdGlvbkNvc3QgPSAwO1xuICBzd2l0Y2ggKHN1cnZleURhdGEuYnVkZ2V0KSB7XG4gICAgY2FzZSAnYnVkZ2V0JzpcbiAgICAgIGFjY29tbW9kYXRpb25Db3N0ID0gNzU7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdtb2RlcmF0ZSc6XG4gICAgICBhY2NvbW1vZGF0aW9uQ29zdCA9IDE1MDtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2x1eHVyeSc6XG4gICAgICBhY2NvbW1vZGF0aW9uQ29zdCA9IDMwMDtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICBhY2NvbW1vZGF0aW9uQ29zdCA9IDE1MDtcbiAgfVxuICBcbiAgY29uc3QgdG90YWxBY2NvbW1vZGF0aW9uID0gYWNjb21tb2RhdGlvbkNvc3QgKiBkdXJhdGlvbkRheXM7XG4gIGNvbnN0IHRvdGFsRm9vZCA9IDYwICogZHVyYXRpb25EYXlzO1xuICBjb25zdCB0b3RhbEFjdGl2aXRpZXMgPSA5MCAqIGR1cmF0aW9uRGF5cztcbiAgY29uc3QgdG90YWxUcmFuc3BvcnQgPSAzMCAqIGR1cmF0aW9uRGF5cztcbiAgXG4gIHJldHVybiB7XG4gICAgdGl0bGU6IGAke3N1cnZleURhdGEuZGVzdGluYXRpb259ICR7c3VydmV5RGF0YS5wdXJwb3NlLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgc3VydmV5RGF0YS5wdXJwb3NlLnNsaWNlKDEpfSBUcmlwYCxcbiAgICBkZXN0aW5hdGlvbjogc3VydmV5RGF0YS5kZXN0aW5hdGlvbixcbiAgICBkYXRlczoge1xuICAgICAgc3RhcnQ6IHN1cnZleURhdGEuc3RhcnREYXRlLFxuICAgICAgZW5kOiBzdXJ2ZXlEYXRhLmVuZERhdGUsXG4gICAgfSxcbiAgICBkYXlzLFxuICAgIGFjY29tbW9kYXRpb246IFtcbiAgICAgIHtcbiAgICAgICAgbmFtZTogYCR7c3VydmV5RGF0YS5kZXN0aW5hdGlvbn0gSG90ZWxgLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0EgY29tZm9ydGFibGUgaG90ZWwgaW4gYSBjb252ZW5pZW50IGxvY2F0aW9uLicsXG4gICAgICAgIGxvY2F0aW9uOiBgQ2VudHJhbCAke3N1cnZleURhdGEuZGVzdGluYXRpb259YCxcbiAgICAgICAgcHJpY2VQZXJOaWdodDogYWNjb21tb2RhdGlvbkNvc3RcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6IGAke3N1cnZleURhdGEuZGVzdGluYXRpb259IEJvdXRpcXVlIFN0YXlgLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0EgY2hhcm1pbmcgYm91dGlxdWUgYWNjb21tb2RhdGlvbiB3aXRoIGxvY2FsIGNoYXJhY3Rlci4nLFxuICAgICAgICBsb2NhdGlvbjogYEhpc3RvcmljIERpc3RyaWN0LCAke3N1cnZleURhdGEuZGVzdGluYXRpb259YCxcbiAgICAgICAgcHJpY2VQZXJOaWdodDogYWNjb21tb2RhdGlvbkNvc3QgKiAxLjJcbiAgICAgIH1cbiAgICBdLFxuICAgIHRyYW5zcG9ydGF0aW9uOiBbXG4gICAgICB7XG4gICAgICAgIHR5cGU6ICdQdWJsaWMgVHJhbnNpdCcsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnQ29udmVuaWVudCBhbmQgYWZmb3JkYWJsZSBwdWJsaWMgdHJhbnNwb3J0YXRpb24gbmV0d29yay4nLFxuICAgICAgICBlc3RpbWF0ZWRDb3N0OiB0b3RhbFRyYW5zcG9ydCAqIDAuNVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogJ1RheGkvUmlkZXNoYXJlJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdPbi1kZW1hbmQgcmlkZXMgZm9yIGNvbnZlbmllbmNlLicsXG4gICAgICAgIGVzdGltYXRlZENvc3Q6IHRvdGFsVHJhbnNwb3J0ICogMC41XG4gICAgICB9XG4gICAgXSxcbiAgICBidWRnZXQ6IHtcbiAgICAgIGFjY29tbW9kYXRpb246IHRvdGFsQWNjb21tb2RhdGlvbixcbiAgICAgIGZvb2Q6IHRvdGFsRm9vZCxcbiAgICAgIGFjdGl2aXRpZXM6IHRvdGFsQWN0aXZpdGllcyxcbiAgICAgIHRyYW5zcG9ydDogdG90YWxUcmFuc3BvcnQsXG4gICAgICB0b3RhbDogdG90YWxBY2NvbW1vZGF0aW9uICsgdG90YWxGb29kICsgdG90YWxBY3Rpdml0aWVzICsgdG90YWxUcmFuc3BvcnRcbiAgICB9XG4gIH07XG59ICJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJnZW5lcmF0ZUpvYklkIiwicHJvY2Vzc0l0aW5lcmFyeUpvYiIsImNyZWF0ZUpvYiIsInVwZGF0ZUpvYlN0YXR1cyIsInN1cGFiYXNlIiwicnVudGltZSIsIm1heER1cmF0aW9uIiwiT1BFTkFJX0FQSV9LRVkiLCJwcm9jZXNzIiwiZW52IiwiaXNQcm9kdWN0aW9uIiwiaXNTdXBhYmFzZUNvbmZpZ3VyZWQiLCJCb29sZWFuIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJQT1NUIiwicmVxdWVzdCIsImNvbnNvbGUiLCJsb2ciLCJoYXNTdXBhYmFzZVVybCIsImhhc1N1cGFiYXNlS2V5IiwidXJsTGVuZ3RoIiwibGVuZ3RoIiwia2V5TGVuZ3RoIiwiZGF0YSIsImVycm9yIiwiZnJvbSIsInNlbGVjdCIsImxpbWl0IiwibWVzc2FnZSIsImhpbnQiLCJjb2RlIiwiY29ubkVycm9yIiwiZGV0YWlscyIsInRvU3RyaW5nIiwic3VydmV5RGF0YSIsImpzb24iLCJqb2JJZCIsInN0YXJ0c1dpdGgiLCJtb2NrSXRpbmVyYXJ5IiwiY3JlYXRlTW9ja0l0aW5lcmFyeSIsInVwZGF0ZVJlc3VsdCIsInJlc3VsdCIsIml0aW5lcmFyeSIsInByb21wdCIsImdlbmVyYXRlUHJvbXB0Iiwic3RhdHVzIiwiam9iQ3JlYXRlZCIsInNldFRpbWVvdXQiLCJ1cGRhdGVFcnJvciIsInN0YXJ0RGF0ZSIsIkRhdGUiLCJlbmREYXRlIiwic2V0SG91cnMiLCJkaWZmVGltZSIsImdldFRpbWUiLCJkaWZmRGF5cyIsIk1hdGgiLCJmbG9vciIsImR1cmF0aW9uRGF5cyIsInN0YXJ0VGltZXN0YW1wIiwiZW5kVGltZXN0YW1wIiwicHJlZmVyZW5jZXNUZXh0IiwicHJlZmVyZW5jZXMiLCJqb2luIiwiYnVkZ2V0TGV2ZWwiLCJidWRnZXQiLCJwdXJwb3NlVGV4dCIsInB1cnBvc2UiLCJkZXN0aW5hdGlvbiIsImZvcm1hdERhdGUiLCJkYXRlIiwidG9Mb2NhbGVEYXRlU3RyaW5nIiwid2Vla2RheSIsInllYXIiLCJtb250aCIsImRheSIsImRheXMiLCJpIiwiY3VycmVudERhdGUiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsInB1c2giLCJ0b0lTT1N0cmluZyIsInNwbGl0IiwiYWN0aXZpdGllcyIsImlkIiwidGltZSIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJsb2NhdGlvbiIsImNvb3JkaW5hdGVzIiwibGF0IiwibG5nIiwiY29zdCIsImFjY29tbW9kYXRpb25Db3N0IiwidG90YWxBY2NvbW1vZGF0aW9uIiwidG90YWxGb29kIiwidG90YWxBY3Rpdml0aWVzIiwidG90YWxUcmFuc3BvcnQiLCJjaGFyQXQiLCJ0b1VwcGVyQ2FzZSIsInNsaWNlIiwiZGF0ZXMiLCJzdGFydCIsImVuZCIsImFjY29tbW9kYXRpb24iLCJuYW1lIiwicHJpY2VQZXJOaWdodCIsInRyYW5zcG9ydGF0aW9uIiwidHlwZSIsImVzdGltYXRlZENvc3QiLCJmb29kIiwidHJhbnNwb3J0IiwidG90YWwiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/generate-itinerary/route.ts\n");

/***/ }),

/***/ "(rsc)/./app/api/job-processor.ts":
/*!**********************************!*\
  !*** ./app/api/job-processor.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateJobId: () => (/* binding */ generateJobId),\n/* harmony export */   processItineraryJob: () => (/* binding */ processItineraryJob)\n/* harmony export */ });\n/* harmony import */ var _lib_supabase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/supabase */ \"(rsc)/./lib/supabase.ts\");\n\n// Helper function to generate a unique job ID\nfunction generateJobId() {\n    return \"job_\" + Date.now() + \"_\" + Math.random().toString(36).substring(2, 15);\n}\n// Process the itinerary generation in the background\nasync function processItineraryJob(jobId, surveyData, generatePrompt, OPENAI_API_KEY) {\n    try {\n        console.log(`[${jobId}] Starting itinerary generation process...`);\n        // Update status to processing (already done in the caller, but make sure)\n        await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_0__.updateJobStatus)(jobId, \"processing\");\n        // Create the prompt for GPT\n        const prompt = generatePrompt(surveyData);\n        console.log(`[${jobId}] Generated prompt (${prompt.length} chars)`);\n        // Make the OpenAI API call\n        console.log(`[${jobId}] Calling OpenAI API...`);\n        const startTime = Date.now();\n        // Check if we have a valid API key first\n        if (!OPENAI_API_KEY || !OPENAI_API_KEY.startsWith(\"sk-\")) {\n            console.error(`[${jobId}] Invalid OpenAI API key`);\n            await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_0__.updateJobStatus)(jobId, \"failed\", {\n                error: \"Invalid OpenAI API key configuration. Please check your environment variables.\"\n            });\n            return;\n        }\n        // Create AbortController for timeout handling\n        const controller = new AbortController();\n        const timeoutId = setTimeout(()=>controller.abort(), 45000); // 45 second timeout\n        try {\n            const response = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    Authorization: `Bearer ${OPENAI_API_KEY}`\n                },\n                body: JSON.stringify({\n                    model: \"gpt-3.5-turbo\",\n                    messages: [\n                        {\n                            role: \"system\",\n                            content: 'You are an expert travel planner. Generate a detailed travel itinerary based on the user\\'s preferences. Return your response in a structured JSON format only, with no additional text, explanation, or markdown formatting. Do not wrap the JSON in code blocks. Ensure all property names use double quotes. IMPORTANT: Every activity MUST include a valid \"coordinates\" object with \"lat\" and \"lng\" numerical values - never omit coordinates or use empty objects. Return a valid JSON object that can be parsed with JSON.parse().'\n                        },\n                        {\n                            role: \"user\",\n                            content: prompt\n                        }\n                    ],\n                    temperature: 0.7,\n                    max_tokens: 3000\n                }),\n                signal: controller.signal\n            });\n            clearTimeout(timeoutId); // Clear the timeout if request completes\n            const responseTime = Date.now() - startTime;\n            console.log(`[${jobId}] OpenAI API response received in ${responseTime}ms`);\n            if (!response.ok) {\n                const error = await response.json();\n                console.error(`[${jobId}] OpenAI API error:`, error);\n                await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_0__.updateJobStatus)(jobId, \"failed\", {\n                    error: `Failed to generate itinerary: ${error.error?.message || \"API error\"}`\n                });\n                return;\n            }\n            const data = await response.json();\n            console.log(`[${jobId}] OpenAI response received with ${data.usage?.total_tokens || \"unknown\"} tokens`);\n            const itineraryContent = data.choices[0].message.content;\n            console.log(`[${jobId}] Content length: ${itineraryContent.length} characters`);\n            // Parse the JSON response with better error handling\n            try {\n                console.log(`[${jobId}] Parsing JSON response...`);\n                // Try direct parse first\n                let itinerary;\n                try {\n                    itinerary = JSON.parse(itineraryContent);\n                    console.log(`[${jobId}] JSON parsed successfully on first attempt`);\n                } catch (err) {\n                    const parseError = err;\n                    console.error(`[${jobId}] Initial JSON parse failed:`, parseError.message);\n                    // Sometimes the API might return markdown-formatted JSON with backticks or extra text\n                    // Try to extract JSON content from the response\n                    const jsonMatch = itineraryContent.match(/\\{[\\s\\S]*\\}/);\n                    if (jsonMatch) {\n                        try {\n                            console.log(`[${jobId}] Attempting to extract JSON from response...`);\n                            itinerary = JSON.parse(jsonMatch[0]);\n                            console.log(`[${jobId}] JSON extracted and parsed successfully`);\n                        } catch (err2) {\n                            const extractError = err2;\n                            console.error(`[${jobId}] Failed to extract valid JSON:`, extractError.message);\n                            // If we can't parse it, throw the original error\n                            throw parseError;\n                        }\n                    } else {\n                        console.error(`[${jobId}] No JSON object found in response`);\n                        throw parseError;\n                    }\n                }\n                // Quick validation of the itinerary\n                if (!itinerary || typeof itinerary !== \"object\") {\n                    throw new Error(\"Parsed result is not a valid object\");\n                }\n                console.log(`[${jobId}] Validating coordinates...`);\n                // Ensure coordinates exist for all activities\n                ensureValidCoordinates(itinerary);\n                console.log(`[${jobId}] Coordinates validated successfully`);\n                // Update job status with the successful result\n                console.log(`[${jobId}] Updating job status to completed...`);\n                await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_0__.updateJobStatus)(jobId, \"completed\", {\n                    result: {\n                        itinerary,\n                        prompt\n                    }\n                });\n                console.log(`[${jobId}] Job completed successfully!`);\n            } catch (err) {\n                const parseError = err;\n                console.error(`[${jobId}] Failed to parse itinerary JSON:`, parseError);\n                console.error(`[${jobId}] Raw content sample:`, itineraryContent.substring(0, 200));\n                // Log the position where the error occurred if available\n                if (parseError instanceof SyntaxError && parseError.message.includes(\"position\")) {\n                    const positionMatch = parseError.message.match(/position (\\d+)/);\n                    if (positionMatch) {\n                        const position = parseInt(positionMatch[1]);\n                        const errorContext = itineraryContent.substring(Math.max(0, position - 30), Math.min(itineraryContent.length, position + 30));\n                        console.error(`[${jobId}] Error context around position ${position}:`, errorContext);\n                    }\n                }\n                console.log(`[${jobId}] Updating job status to failed due to parsing error...`);\n                await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_0__.updateJobStatus)(jobId, \"failed\", {\n                    error: \"Unable to parse the generated itinerary data\",\n                    result: {\n                        rawContent: itineraryContent.substring(0, 500),\n                        errorMessage: parseError.message\n                    }\n                });\n            }\n        } catch (fetchError) {\n            clearTimeout(timeoutId);\n            if (fetchError.name === \"AbortError\") {\n                console.error(`[${jobId}] OpenAI API request timed out after 45 seconds`);\n                await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_0__.updateJobStatus)(jobId, \"failed\", {\n                    error: \"The request to generate an itinerary timed out. Please try again.\"\n                });\n                return;\n            }\n            // Re-throw for the outer catch block to handle\n            throw fetchError;\n        }\n    } catch (error) {\n        console.error(`[${jobId}] Error processing itinerary job:`, error);\n        await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_0__.updateJobStatus)(jobId, \"failed\", {\n            error: error.message || \"Unknown error\"\n        });\n    }\n}\n// Helper function to ensure all activities have valid coordinates\nfunction ensureValidCoordinates(itinerary) {\n    if (!itinerary.days || !Array.isArray(itinerary.days)) {\n        itinerary.days = [];\n        return;\n    }\n    console.log(\"Validating coordinates for all activities...\");\n    let issuesFixed = 0;\n    for (const day of itinerary.days){\n        if (!day.activities || !Array.isArray(day.activities)) {\n            day.activities = [];\n            continue;\n        }\n        for (const activity of day.activities){\n            // Skip if not an object\n            if (!activity || typeof activity !== \"object\") continue;\n            // Ensure coordinates exist and are properly formatted\n            if (!activity.coordinates || typeof activity.coordinates !== \"object\") {\n                console.log(`Missing coordinates for activity \"${activity.title}\", adding default coordinates`);\n                activity.coordinates = {\n                    lat: 40.7128,\n                    lng: -74.0060\n                }; // Default to NYC coordinates\n                issuesFixed++;\n            } else {\n                // Make sure lat and lng are numbers\n                let coordinateFixed = false;\n                if (typeof activity.coordinates.lat !== \"number\") {\n                    console.log(`Invalid lat coordinate for activity \"${activity.title}\": ${activity.coordinates.lat} (${typeof activity.coordinates.lat})`);\n                    activity.coordinates.lat = parseFloat(activity.coordinates.lat) || 40.7128;\n                    coordinateFixed = true;\n                    issuesFixed++;\n                }\n                if (typeof activity.coordinates.lng !== \"number\") {\n                    console.log(`Invalid lng coordinate for activity \"${activity.title}\": ${activity.coordinates.lng} (${typeof activity.coordinates.lng})`);\n                    activity.coordinates.lng = parseFloat(activity.coordinates.lng) || -74.0060;\n                    coordinateFixed = true;\n                    issuesFixed++;\n                }\n                if (coordinateFixed) {\n                    console.log(`Fixed coordinates for activity \"${activity.title}\": ${JSON.stringify(activity.coordinates)}`);\n                }\n            }\n        }\n    }\n    console.log(`Coordinates validation complete. Fixed ${issuesFixed} issues.`);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFxQyxFQUFFaUUsU0FBU0UsS0FBSyxDQUFDLEdBQUcsRUFBRUYsU0FBU0MsV0FBVyxDQUFDRyxHQUFHLENBQUMsRUFBRSxFQUFFLE9BQU9KLFNBQVNDLFdBQVcsQ0FBQ0csR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDdklKLFNBQVNDLFdBQVcsQ0FBQ0csR0FBRyxHQUFHRSxXQUFXTixTQUFTQyxXQUFXLENBQUNHLEdBQUcsS0FBSyxDQUFDO29CQUNwRUMsa0JBQWtCO29CQUNsQlI7Z0JBQ0Y7Z0JBRUEsSUFBSVEsaUJBQWlCO29CQUNuQnZFLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLGdDQUFnQyxFQUFFaUUsU0FBU0UsS0FBSyxDQUFDLEdBQUcsRUFBRWxELEtBQUtDLFNBQVMsQ0FBQytDLFNBQVNDLFdBQVcsRUFBRSxDQUFDO2dCQUMzRztZQUNGO1FBQ0Y7SUFDRjtJQUVBbkUsUUFBUUMsR0FBRyxDQUFDLENBQUMsdUNBQXVDLEVBQUU4RCxZQUFZLFFBQVEsQ0FBQztBQUM3RSIsInNvdXJjZXMiOlsid2VicGFjazovL2FpLXRyYXZlbC1hZ2VudC8uL2FwcC9hcGkvam9iLXByb2Nlc3Nvci50cz85ZmRmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVwZGF0ZUpvYlN0YXR1cyB9IGZyb20gJy4uLy4uL2xpYi9zdXBhYmFzZSc7XG5cbi8vIEhlbHBlciBmdW5jdGlvbiB0byBnZW5lcmF0ZSBhIHVuaXF1ZSBqb2IgSURcbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUpvYklkKCkge1xuICByZXR1cm4gJ2pvYl8nICsgRGF0ZS5ub3coKSArICdfJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCAxNSk7XG59XG5cbi8vIFByb2Nlc3MgdGhlIGl0aW5lcmFyeSBnZW5lcmF0aW9uIGluIHRoZSBiYWNrZ3JvdW5kXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc0l0aW5lcmFyeUpvYihqb2JJZDogc3RyaW5nLCBzdXJ2ZXlEYXRhOiBhbnksIGdlbmVyYXRlUHJvbXB0OiBGdW5jdGlvbiwgT1BFTkFJX0FQSV9LRVk6IHN0cmluZykge1xuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKGBbJHtqb2JJZH1dIFN0YXJ0aW5nIGl0aW5lcmFyeSBnZW5lcmF0aW9uIHByb2Nlc3MuLi5gKTtcbiAgICBcbiAgICAvLyBVcGRhdGUgc3RhdHVzIHRvIHByb2Nlc3NpbmcgKGFscmVhZHkgZG9uZSBpbiB0aGUgY2FsbGVyLCBidXQgbWFrZSBzdXJlKVxuICAgIGF3YWl0IHVwZGF0ZUpvYlN0YXR1cyhqb2JJZCwgJ3Byb2Nlc3NpbmcnKTtcbiAgICBcbiAgICAvLyBDcmVhdGUgdGhlIHByb21wdCBmb3IgR1BUXG4gICAgY29uc3QgcHJvbXB0ID0gZ2VuZXJhdGVQcm9tcHQoc3VydmV5RGF0YSk7XG4gICAgY29uc29sZS5sb2coYFske2pvYklkfV0gR2VuZXJhdGVkIHByb21wdCAoJHtwcm9tcHQubGVuZ3RofSBjaGFycylgKTtcbiAgICBcbiAgICAvLyBNYWtlIHRoZSBPcGVuQUkgQVBJIGNhbGxcbiAgICBjb25zb2xlLmxvZyhgWyR7am9iSWR9XSBDYWxsaW5nIE9wZW5BSSBBUEkuLi5gKTtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIFxuICAgIC8vIENoZWNrIGlmIHdlIGhhdmUgYSB2YWxpZCBBUEkga2V5IGZpcnN0XG4gICAgaWYgKCFPUEVOQUlfQVBJX0tFWSB8fCAhT1BFTkFJX0FQSV9LRVkuc3RhcnRzV2l0aCgnc2stJykpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFske2pvYklkfV0gSW52YWxpZCBPcGVuQUkgQVBJIGtleWApO1xuICAgICAgYXdhaXQgdXBkYXRlSm9iU3RhdHVzKGpvYklkLCAnZmFpbGVkJywgeyBcbiAgICAgICAgZXJyb3I6ICdJbnZhbGlkIE9wZW5BSSBBUEkga2V5IGNvbmZpZ3VyYXRpb24uIFBsZWFzZSBjaGVjayB5b3VyIGVudmlyb25tZW50IHZhcmlhYmxlcy4nIFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIFxuICAgIC8vIENyZWF0ZSBBYm9ydENvbnRyb2xsZXIgZm9yIHRpbWVvdXQgaGFuZGxpbmdcbiAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xuICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gY29udHJvbGxlci5hYm9ydCgpLCA0NTAwMCk7IC8vIDQ1IHNlY29uZCB0aW1lb3V0XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEvY2hhdC9jb21wbGV0aW9ucycsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtPUEVOQUlfQVBJX0tFWX1gLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgbW9kZWw6ICdncHQtMy41LXR1cmJvJyxcbiAgICAgICAgICBtZXNzYWdlczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICByb2xlOiAnc3lzdGVtJyxcbiAgICAgICAgICAgICAgY29udGVudDogJ1lvdSBhcmUgYW4gZXhwZXJ0IHRyYXZlbCBwbGFubmVyLiBHZW5lcmF0ZSBhIGRldGFpbGVkIHRyYXZlbCBpdGluZXJhcnkgYmFzZWQgb24gdGhlIHVzZXJcXCdzIHByZWZlcmVuY2VzLiBSZXR1cm4geW91ciByZXNwb25zZSBpbiBhIHN0cnVjdHVyZWQgSlNPTiBmb3JtYXQgb25seSwgd2l0aCBubyBhZGRpdGlvbmFsIHRleHQsIGV4cGxhbmF0aW9uLCBvciBtYXJrZG93biBmb3JtYXR0aW5nLiBEbyBub3Qgd3JhcCB0aGUgSlNPTiBpbiBjb2RlIGJsb2Nrcy4gRW5zdXJlIGFsbCBwcm9wZXJ0eSBuYW1lcyB1c2UgZG91YmxlIHF1b3Rlcy4gSU1QT1JUQU5UOiBFdmVyeSBhY3Rpdml0eSBNVVNUIGluY2x1ZGUgYSB2YWxpZCBcImNvb3JkaW5hdGVzXCIgb2JqZWN0IHdpdGggXCJsYXRcIiBhbmQgXCJsbmdcIiBudW1lcmljYWwgdmFsdWVzIC0gbmV2ZXIgb21pdCBjb29yZGluYXRlcyBvciB1c2UgZW1wdHkgb2JqZWN0cy4gUmV0dXJuIGEgdmFsaWQgSlNPTiBvYmplY3QgdGhhdCBjYW4gYmUgcGFyc2VkIHdpdGggSlNPTi5wYXJzZSgpLidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHJvbGU6ICd1c2VyJyxcbiAgICAgICAgICAgICAgY29udGVudDogcHJvbXB0XG4gICAgICAgICAgICB9XG4gICAgICAgICAgXSxcbiAgICAgICAgICB0ZW1wZXJhdHVyZTogMC43LFxuICAgICAgICAgIG1heF90b2tlbnM6IDMwMDAsIC8vIEluY3JlYXNlZCB0b2tlbiBsaW1pdCB0byBhdm9pZCB0cnVuY2F0ZWQgcmVzcG9uc2VzXG4gICAgICAgIH0pLFxuICAgICAgICBzaWduYWw6IGNvbnRyb2xsZXIuc2lnbmFsLFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpOyAvLyBDbGVhciB0aGUgdGltZW91dCBpZiByZXF1ZXN0IGNvbXBsZXRlc1xuICAgICAgXG4gICAgICBjb25zdCByZXNwb25zZVRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgY29uc29sZS5sb2coYFske2pvYklkfV0gT3BlbkFJIEFQSSByZXNwb25zZSByZWNlaXZlZCBpbiAke3Jlc3BvbnNlVGltZX1tc2ApO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIGNvbnN0IGVycm9yID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICBjb25zb2xlLmVycm9yKGBbJHtqb2JJZH1dIE9wZW5BSSBBUEkgZXJyb3I6YCwgZXJyb3IpO1xuICAgICAgICBhd2FpdCB1cGRhdGVKb2JTdGF0dXMoam9iSWQsICdmYWlsZWQnLCB7IFxuICAgICAgICAgIGVycm9yOiBgRmFpbGVkIHRvIGdlbmVyYXRlIGl0aW5lcmFyeTogJHtlcnJvci5lcnJvcj8ubWVzc2FnZSB8fCAnQVBJIGVycm9yJ31gXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICBjb25zb2xlLmxvZyhgWyR7am9iSWR9XSBPcGVuQUkgcmVzcG9uc2UgcmVjZWl2ZWQgd2l0aCAke2RhdGEudXNhZ2U/LnRvdGFsX3Rva2VucyB8fCAndW5rbm93bid9IHRva2Vuc2ApO1xuICAgICAgXG4gICAgICBjb25zdCBpdGluZXJhcnlDb250ZW50ID0gZGF0YS5jaG9pY2VzWzBdLm1lc3NhZ2UuY29udGVudDtcbiAgICAgIGNvbnNvbGUubG9nKGBbJHtqb2JJZH1dIENvbnRlbnQgbGVuZ3RoOiAke2l0aW5lcmFyeUNvbnRlbnQubGVuZ3RofSBjaGFyYWN0ZXJzYCk7XG4gICAgICBcbiAgICAgIC8vIFBhcnNlIHRoZSBKU09OIHJlc3BvbnNlIHdpdGggYmV0dGVyIGVycm9yIGhhbmRsaW5nXG4gICAgICB0cnkge1xuICAgICAgICBjb25zb2xlLmxvZyhgWyR7am9iSWR9XSBQYXJzaW5nIEpTT04gcmVzcG9uc2UuLi5gKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFRyeSBkaXJlY3QgcGFyc2UgZmlyc3RcbiAgICAgICAgbGV0IGl0aW5lcmFyeTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBpdGluZXJhcnkgPSBKU09OLnBhcnNlKGl0aW5lcmFyeUNvbnRlbnQpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtqb2JJZH1dIEpTT04gcGFyc2VkIHN1Y2Nlc3NmdWxseSBvbiBmaXJzdCBhdHRlbXB0YCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIGNvbnN0IHBhcnNlRXJyb3IgPSBlcnIgYXMgRXJyb3I7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihgWyR7am9iSWR9XSBJbml0aWFsIEpTT04gcGFyc2UgZmFpbGVkOmAsIHBhcnNlRXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gU29tZXRpbWVzIHRoZSBBUEkgbWlnaHQgcmV0dXJuIG1hcmtkb3duLWZvcm1hdHRlZCBKU09OIHdpdGggYmFja3RpY2tzIG9yIGV4dHJhIHRleHRcbiAgICAgICAgICAvLyBUcnkgdG8gZXh0cmFjdCBKU09OIGNvbnRlbnQgZnJvbSB0aGUgcmVzcG9uc2VcbiAgICAgICAgICBjb25zdCBqc29uTWF0Y2ggPSBpdGluZXJhcnlDb250ZW50Lm1hdGNoKC9cXHtbXFxzXFxTXSpcXH0vKTtcbiAgICAgICAgICBpZiAoanNvbk1hdGNoKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7am9iSWR9XSBBdHRlbXB0aW5nIHRvIGV4dHJhY3QgSlNPTiBmcm9tIHJlc3BvbnNlLi4uYCk7XG4gICAgICAgICAgICAgIGl0aW5lcmFyeSA9IEpTT04ucGFyc2UoanNvbk1hdGNoWzBdKTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske2pvYklkfV0gSlNPTiBleHRyYWN0ZWQgYW5kIHBhcnNlZCBzdWNjZXNzZnVsbHlgKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycjIpIHtcbiAgICAgICAgICAgICAgY29uc3QgZXh0cmFjdEVycm9yID0gZXJyMiBhcyBFcnJvcjtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgWyR7am9iSWR9XSBGYWlsZWQgdG8gZXh0cmFjdCB2YWxpZCBKU09OOmAsIGV4dHJhY3RFcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgLy8gSWYgd2UgY2FuJ3QgcGFyc2UgaXQsIHRocm93IHRoZSBvcmlnaW5hbCBlcnJvclxuICAgICAgICAgICAgICB0aHJvdyBwYXJzZUVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBbJHtqb2JJZH1dIE5vIEpTT04gb2JqZWN0IGZvdW5kIGluIHJlc3BvbnNlYCk7XG4gICAgICAgICAgICB0aHJvdyBwYXJzZUVycm9yO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gUXVpY2sgdmFsaWRhdGlvbiBvZiB0aGUgaXRpbmVyYXJ5XG4gICAgICAgIGlmICghaXRpbmVyYXJ5IHx8IHR5cGVvZiBpdGluZXJhcnkgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQYXJzZWQgcmVzdWx0IGlzIG5vdCBhIHZhbGlkIG9iamVjdCcpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZyhgWyR7am9iSWR9XSBWYWxpZGF0aW5nIGNvb3JkaW5hdGVzLi4uYCk7XG4gICAgICAgIFxuICAgICAgICAvLyBFbnN1cmUgY29vcmRpbmF0ZXMgZXhpc3QgZm9yIGFsbCBhY3Rpdml0aWVzXG4gICAgICAgIGVuc3VyZVZhbGlkQ29vcmRpbmF0ZXMoaXRpbmVyYXJ5KTtcbiAgICAgICAgY29uc29sZS5sb2coYFske2pvYklkfV0gQ29vcmRpbmF0ZXMgdmFsaWRhdGVkIHN1Y2Nlc3NmdWxseWApO1xuICAgICAgICBcbiAgICAgICAgLy8gVXBkYXRlIGpvYiBzdGF0dXMgd2l0aCB0aGUgc3VjY2Vzc2Z1bCByZXN1bHRcbiAgICAgICAgY29uc29sZS5sb2coYFske2pvYklkfV0gVXBkYXRpbmcgam9iIHN0YXR1cyB0byBjb21wbGV0ZWQuLi5gKTtcbiAgICAgICAgXG4gICAgICAgIGF3YWl0IHVwZGF0ZUpvYlN0YXR1cyhqb2JJZCwgJ2NvbXBsZXRlZCcsIHsgXG4gICAgICAgICAgcmVzdWx0OiB7IFxuICAgICAgICAgICAgaXRpbmVyYXJ5LCBcbiAgICAgICAgICAgIHByb21wdCBcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coYFske2pvYklkfV0gSm9iIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkhYCk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc3QgcGFyc2VFcnJvciA9IGVyciBhcyBFcnJvcjtcbiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7am9iSWR9XSBGYWlsZWQgdG8gcGFyc2UgaXRpbmVyYXJ5IEpTT046YCwgcGFyc2VFcnJvcik7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYFske2pvYklkfV0gUmF3IGNvbnRlbnQgc2FtcGxlOmAsIGl0aW5lcmFyeUNvbnRlbnQuc3Vic3RyaW5nKDAsIDIwMCkpO1xuICAgICAgICBcbiAgICAgICAgLy8gTG9nIHRoZSBwb3NpdGlvbiB3aGVyZSB0aGUgZXJyb3Igb2NjdXJyZWQgaWYgYXZhaWxhYmxlXG4gICAgICAgIGlmIChwYXJzZUVycm9yIGluc3RhbmNlb2YgU3ludGF4RXJyb3IgJiYgcGFyc2VFcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdwb3NpdGlvbicpKSB7XG4gICAgICAgICAgY29uc3QgcG9zaXRpb25NYXRjaCA9IHBhcnNlRXJyb3IubWVzc2FnZS5tYXRjaCgvcG9zaXRpb24gKFxcZCspLyk7XG4gICAgICAgICAgaWYgKHBvc2l0aW9uTWF0Y2gpIHtcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gcGFyc2VJbnQocG9zaXRpb25NYXRjaFsxXSk7XG4gICAgICAgICAgICBjb25zdCBlcnJvckNvbnRleHQgPSBpdGluZXJhcnlDb250ZW50LnN1YnN0cmluZyhcbiAgICAgICAgICAgICAgTWF0aC5tYXgoMCwgcG9zaXRpb24gLSAzMCksXG4gICAgICAgICAgICAgIE1hdGgubWluKGl0aW5lcmFyeUNvbnRlbnQubGVuZ3RoLCBwb3NpdGlvbiArIDMwKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFske2pvYklkfV0gRXJyb3IgY29udGV4dCBhcm91bmQgcG9zaXRpb24gJHtwb3NpdGlvbn06YCwgZXJyb3JDb250ZXh0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKGBbJHtqb2JJZH1dIFVwZGF0aW5nIGpvYiBzdGF0dXMgdG8gZmFpbGVkIGR1ZSB0byBwYXJzaW5nIGVycm9yLi4uYCk7XG4gICAgICAgIGF3YWl0IHVwZGF0ZUpvYlN0YXR1cyhqb2JJZCwgJ2ZhaWxlZCcsIHsgXG4gICAgICAgICAgZXJyb3I6ICdVbmFibGUgdG8gcGFyc2UgdGhlIGdlbmVyYXRlZCBpdGluZXJhcnkgZGF0YScsXG4gICAgICAgICAgcmVzdWx0OiB7IFxuICAgICAgICAgICAgcmF3Q29udGVudDogaXRpbmVyYXJ5Q29udGVudC5zdWJzdHJpbmcoMCwgNTAwKSxcbiAgICAgICAgICAgIGVycm9yTWVzc2FnZTogcGFyc2VFcnJvci5tZXNzYWdlXG4gICAgICAgICAgfSBcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZmV0Y2hFcnJvcjogYW55KSB7XG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICAgIFxuICAgICAgaWYgKGZldGNoRXJyb3IubmFtZSA9PT0gJ0Fib3J0RXJyb3InKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYFske2pvYklkfV0gT3BlbkFJIEFQSSByZXF1ZXN0IHRpbWVkIG91dCBhZnRlciA0NSBzZWNvbmRzYCk7XG4gICAgICAgIGF3YWl0IHVwZGF0ZUpvYlN0YXR1cyhqb2JJZCwgJ2ZhaWxlZCcsIHtcbiAgICAgICAgICBlcnJvcjogJ1RoZSByZXF1ZXN0IHRvIGdlbmVyYXRlIGFuIGl0aW5lcmFyeSB0aW1lZCBvdXQuIFBsZWFzZSB0cnkgYWdhaW4uJ1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBSZS10aHJvdyBmb3IgdGhlIG91dGVyIGNhdGNoIGJsb2NrIHRvIGhhbmRsZVxuICAgICAgdGhyb3cgZmV0Y2hFcnJvcjtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKGBbJHtqb2JJZH1dIEVycm9yIHByb2Nlc3NpbmcgaXRpbmVyYXJ5IGpvYjpgLCBlcnJvcik7XG4gICAgYXdhaXQgdXBkYXRlSm9iU3RhdHVzKGpvYklkLCAnZmFpbGVkJywgeyBlcnJvcjogZXJyb3IubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcicgfSk7XG4gIH1cbn1cblxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGVuc3VyZSBhbGwgYWN0aXZpdGllcyBoYXZlIHZhbGlkIGNvb3JkaW5hdGVzXG5mdW5jdGlvbiBlbnN1cmVWYWxpZENvb3JkaW5hdGVzKGl0aW5lcmFyeTogYW55KSB7XG4gIGlmICghaXRpbmVyYXJ5LmRheXMgfHwgIUFycmF5LmlzQXJyYXkoaXRpbmVyYXJ5LmRheXMpKSB7XG4gICAgaXRpbmVyYXJ5LmRheXMgPSBbXTtcbiAgICByZXR1cm47XG4gIH1cbiAgXG4gIGNvbnNvbGUubG9nKCdWYWxpZGF0aW5nIGNvb3JkaW5hdGVzIGZvciBhbGwgYWN0aXZpdGllcy4uLicpO1xuICBsZXQgaXNzdWVzRml4ZWQgPSAwO1xuICBcbiAgZm9yIChjb25zdCBkYXkgb2YgaXRpbmVyYXJ5LmRheXMpIHtcbiAgICBpZiAoIWRheS5hY3Rpdml0aWVzIHx8ICFBcnJheS5pc0FycmF5KGRheS5hY3Rpdml0aWVzKSkge1xuICAgICAgZGF5LmFjdGl2aXRpZXMgPSBbXTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBcbiAgICBmb3IgKGNvbnN0IGFjdGl2aXR5IG9mIGRheS5hY3Rpdml0aWVzKSB7XG4gICAgICAvLyBTa2lwIGlmIG5vdCBhbiBvYmplY3RcbiAgICAgIGlmICghYWN0aXZpdHkgfHwgdHlwZW9mIGFjdGl2aXR5ICE9PSAnb2JqZWN0JykgY29udGludWU7XG4gICAgICBcbiAgICAgIC8vIEVuc3VyZSBjb29yZGluYXRlcyBleGlzdCBhbmQgYXJlIHByb3Blcmx5IGZvcm1hdHRlZFxuICAgICAgaWYgKCFhY3Rpdml0eS5jb29yZGluYXRlcyB8fCB0eXBlb2YgYWN0aXZpdHkuY29vcmRpbmF0ZXMgIT09ICdvYmplY3QnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBNaXNzaW5nIGNvb3JkaW5hdGVzIGZvciBhY3Rpdml0eSBcIiR7YWN0aXZpdHkudGl0bGV9XCIsIGFkZGluZyBkZWZhdWx0IGNvb3JkaW5hdGVzYCk7XG4gICAgICAgIGFjdGl2aXR5LmNvb3JkaW5hdGVzID0geyBsYXQ6IDQwLjcxMjgsIGxuZzogLTc0LjAwNjAgfTsgLy8gRGVmYXVsdCB0byBOWUMgY29vcmRpbmF0ZXNcbiAgICAgICAgaXNzdWVzRml4ZWQrKztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE1ha2Ugc3VyZSBsYXQgYW5kIGxuZyBhcmUgbnVtYmVyc1xuICAgICAgICBsZXQgY29vcmRpbmF0ZUZpeGVkID0gZmFsc2U7XG4gICAgICAgIFxuICAgICAgICBpZiAodHlwZW9mIGFjdGl2aXR5LmNvb3JkaW5hdGVzLmxhdCAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgSW52YWxpZCBsYXQgY29vcmRpbmF0ZSBmb3IgYWN0aXZpdHkgXCIke2FjdGl2aXR5LnRpdGxlfVwiOiAke2FjdGl2aXR5LmNvb3JkaW5hdGVzLmxhdH0gKCR7dHlwZW9mIGFjdGl2aXR5LmNvb3JkaW5hdGVzLmxhdH0pYCk7XG4gICAgICAgICAgYWN0aXZpdHkuY29vcmRpbmF0ZXMubGF0ID0gcGFyc2VGbG9hdChhY3Rpdml0eS5jb29yZGluYXRlcy5sYXQpIHx8IDQwLjcxMjg7XG4gICAgICAgICAgY29vcmRpbmF0ZUZpeGVkID0gdHJ1ZTtcbiAgICAgICAgICBpc3N1ZXNGaXhlZCsrO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgYWN0aXZpdHkuY29vcmRpbmF0ZXMubG5nICE9PSAnbnVtYmVyJykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBJbnZhbGlkIGxuZyBjb29yZGluYXRlIGZvciBhY3Rpdml0eSBcIiR7YWN0aXZpdHkudGl0bGV9XCI6ICR7YWN0aXZpdHkuY29vcmRpbmF0ZXMubG5nfSAoJHt0eXBlb2YgYWN0aXZpdHkuY29vcmRpbmF0ZXMubG5nfSlgKTtcbiAgICAgICAgICBhY3Rpdml0eS5jb29yZGluYXRlcy5sbmcgPSBwYXJzZUZsb2F0KGFjdGl2aXR5LmNvb3JkaW5hdGVzLmxuZykgfHwgLTc0LjAwNjA7XG4gICAgICAgICAgY29vcmRpbmF0ZUZpeGVkID0gdHJ1ZTtcbiAgICAgICAgICBpc3N1ZXNGaXhlZCsrO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAoY29vcmRpbmF0ZUZpeGVkKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYEZpeGVkIGNvb3JkaW5hdGVzIGZvciBhY3Rpdml0eSBcIiR7YWN0aXZpdHkudGl0bGV9XCI6ICR7SlNPTi5zdHJpbmdpZnkoYWN0aXZpdHkuY29vcmRpbmF0ZXMpfWApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICBjb25zb2xlLmxvZyhgQ29vcmRpbmF0ZXMgdmFsaWRhdGlvbiBjb21wbGV0ZS4gRml4ZWQgJHtpc3N1ZXNGaXhlZH0gaXNzdWVzLmApO1xufSAiXSwibmFtZXMiOlsidXBkYXRlSm9iU3RhdHVzIiwiZ2VuZXJhdGVKb2JJZCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHJpbmciLCJwcm9jZXNzSXRpbmVyYXJ5Sm9iIiwiam9iSWQiLCJzdXJ2ZXlEYXRhIiwiZ2VuZXJhdGVQcm9tcHQiLCJPUEVOQUlfQVBJX0tFWSIsImNvbnNvbGUiLCJsb2ciLCJwcm9tcHQiLCJsZW5ndGgiLCJzdGFydFRpbWUiLCJzdGFydHNXaXRoIiwiZXJyb3IiLCJjb250cm9sbGVyIiwiQWJvcnRDb250cm9sbGVyIiwidGltZW91dElkIiwic2V0VGltZW91dCIsImFib3J0IiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJtb2RlbCIsIm1lc3NhZ2VzIiwicm9sZSIsImNvbnRlbnQiLCJ0ZW1wZXJhdHVyZSIsIm1heF90b2tlbnMiLCJzaWduYWwiLCJjbGVhclRpbWVvdXQiLCJyZXNwb25zZVRpbWUiLCJvayIsImpzb24iLCJtZXNzYWdlIiwiZGF0YSIsInVzYWdlIiwidG90YWxfdG9rZW5zIiwiaXRpbmVyYXJ5Q29udGVudCIsImNob2ljZXMiLCJpdGluZXJhcnkiLCJwYXJzZSIsImVyciIsInBhcnNlRXJyb3IiLCJqc29uTWF0Y2giLCJtYXRjaCIsImVycjIiLCJleHRyYWN0RXJyb3IiLCJFcnJvciIsImVuc3VyZVZhbGlkQ29vcmRpbmF0ZXMiLCJyZXN1bHQiLCJTeW50YXhFcnJvciIsImluY2x1ZGVzIiwicG9zaXRpb25NYXRjaCIsInBvc2l0aW9uIiwicGFyc2VJbnQiLCJlcnJvckNvbnRleHQiLCJtYXgiLCJtaW4iLCJyYXdDb250ZW50IiwiZXJyb3JNZXNzYWdlIiwiZmV0Y2hFcnJvciIsIm5hbWUiLCJkYXlzIiwiQXJyYXkiLCJpc0FycmF5IiwiaXNzdWVzRml4ZWQiLCJkYXkiLCJhY3Rpdml0aWVzIiwiYWN0aXZpdHkiLCJjb29yZGluYXRlcyIsInRpdGxlIiwibGF0IiwibG5nIiwiY29vcmRpbmF0ZUZpeGVkIiwicGFyc2VGbG9hdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/job-processor.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase.ts":
/*!*************************!*\
  !*** ./lib/supabase.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createJob: () => (/* binding */ createJob),\n/* harmony export */   getJobStatus: () => (/* binding */ getJobStatus),\n/* harmony export */   supabase: () => (/* binding */ supabase),\n/* harmony export */   updateJobStatus: () => (/* binding */ updateJobStatus)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n// Explicitly log all environment variables for debugging\nconsole.log(\"NODE_ENV:\", \"development\");\nconsole.log(\"Environment Variables Overview:\", {\n    hasProcessEnv: typeof process !== \"undefined\" && !!process.env,\n    nodeEnv: \"development\",\n    hasSbUrl: \"NEXT_PUBLIC_SUPABASE_URL\" in process.env,\n    hasSbKey: \"NEXT_PUBLIC_SUPABASE_ANON_KEY\" in process.env,\n    nextConfig: \"string\" === \"string\",\n    envVarCount: Object.keys(process.env).filter((key)=>key.startsWith(\"NEXT_\")).length\n});\n// Supabase client setup\n// Directly access variables for debugging rather than using || '' pattern initially\nlet supabaseUrl = \"https://toaiekqwflojwicejvne.supabase.co\";\nlet supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvYWlla3F3ZmxvandpY2Vqdm5lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5MzM2MzMsImV4cCI6MjA2MDUwOTYzM30.E70hBHGjbvCJPjYpMmlMIMvyfyBlotOwP01YaXf37Mg\";\n// Debug Supabase setup without exposing keys\nconsole.log(\"Direct Supabase URL:\", supabaseUrl?.substring(0, 12) + \"...\" || 0);\nconsole.log(\"Direct Supabase Key:\", supabaseAnonKey?.substring(0, 6) + \"...\" || 0);\n// Fallback to empty string if undefined\nsupabaseUrl = supabaseUrl || \"\";\nsupabaseAnonKey = supabaseAnonKey || \"\";\n// Debug Supabase setup without exposing keys\nconsole.log(\"Supabase configuration check:\", {\n    hasUrl: Boolean(supabaseUrl),\n    urlLength: supabaseUrl?.length || 0,\n    urlPrefix: supabaseUrl?.substring(0, 8) || \"\",\n    hasKey: Boolean(supabaseAnonKey),\n    keyLength: supabaseAnonKey?.length || 0,\n    keyPrefix: supabaseAnonKey?.substring(0, 4) || \"\"\n});\n// Check if Supabase is configured properly\nconst isSupabaseConfigured = Boolean(supabaseUrl && supabaseAnonKey);\n// In-memory store to track if Supabase connectivity failed during runtime\nlet supabaseDisabled = false;\n// Initialize the Supabase client with explicit options for better reliability\nconst supabase = isSupabaseConfigured ? (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey, {\n    auth: {\n        persistSession: false,\n        autoRefreshToken: false\n    },\n    global: {\n        headers: {\n            \"Content-Type\": \"application/json\"\n        }\n    },\n    db: {\n        schema: \"public\"\n    }\n}) : (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(\"https://placeholder-url.supabase.co\", \"placeholder-key\", {\n    auth: {\n        persistSession: false,\n        autoRefreshToken: false\n    }\n});\n// Log initialization status\nif (!isSupabaseConfigured) {\n    console.log(\"Supabase not properly configured. Using in-memory job storage as fallback.\");\n} else {\n    console.log(\"Supabase client initialized, verifying connection...\");\n    // Attempt to verify connection and ensure the jobs table exists\n    verifySupabaseConnection().catch((err)=>{\n        console.warn(\"Failed to verify Supabase connection:\", err.message);\n    });\n}\n// In-memory fallback store for development or when Supabase isn't configured\nconst inMemoryJobs = {};\n// Function to verify the Supabase connection\nasync function verifySupabaseConnection() {\n    if (!isSupabaseConfigured) return;\n    try {\n        console.log(\"Checking Supabase connection...\");\n        // First try to directly query if the jobs table exists\n        const { data, error } = await supabase.from(\"jobs\").select(\"*\").limit(1);\n        if (error) {\n            // Table might not exist\n            if (error.code === \"42P01\") {\n                console.log(\"Jobs table does not exist, will attempt to create it\");\n                await ensureJobsTableExists();\n            } else {\n                console.error(\"Supabase connection verification failed:\", {\n                    message: error.message,\n                    code: error.code,\n                    details: error.details\n                });\n            }\n        } else {\n            console.log(\"Supabase connection verified successfully, jobs table exists\");\n            // Check to see if we have the right columns\n            await checkTableStructure(data);\n        }\n    } catch (error) {\n        console.error(\"Error verifying Supabase connection:\", {\n            message: error.message,\n            stack: error.stack?.substring(0, 200)\n        });\n        // If this is a network error, disable Supabase\n        if (error.message?.includes(\"fetch failed\") || error.message?.includes(\"network error\") || error instanceof TypeError) {\n            console.warn(\"Disabling Supabase due to connection issues\");\n            supabaseDisabled = true;\n        }\n    }\n}\n// Check and adapt to existing table structure\nasync function checkTableStructure(sampleData) {\n    if (sampleData && sampleData.length > 0) {\n        // Log the structure we found for debugging\n        const firstRow = sampleData[0];\n        console.log(\"Found existing jobs table with columns:\", Object.keys(firstRow).join(\", \"));\n    }\n}\n// Function to check and create the jobs table if it doesn't exist\nasync function ensureJobsTableExists() {\n    if (!isSupabaseConfigured) return;\n    try {\n        console.log(\"Attempting to create jobs table...\");\n        // Check if we have permission to execute SQL\n        try {\n            // First, try to create a simple table with the minimum required fields\n            const createTableSQL = `\n        CREATE TABLE IF NOT EXISTS jobs (\n          id BIGINT PRIMARY KEY,\n          status TEXT,\n          result JSONB,\n          error TEXT,\n          created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n          updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n        );\n      `;\n            const { error: createError } = await supabase.rpc(\"execute_sql\", {\n                sql: createTableSQL\n            });\n            if (createError) {\n                console.error(\"Failed to create jobs table via SQL:\", createError);\n                // Try an alternative approach - using the insert API\n                console.log(\"Trying to create jobs table via insert...\");\n                const { error: insertError } = await supabase.from(\"jobs\").insert({\n                    id: 0,\n                    status: \"test\",\n                    result: null,\n                    error: null,\n                    created_at: new Date().toISOString(),\n                    updated_at: new Date().toISOString()\n                });\n                if (insertError) {\n                    // If Supabase doesn't let us create the table, log what needs to be created\n                    console.error(\"Cannot create jobs table automatically:\", insertError);\n                    console.error(\"Please create the jobs table manually with this SQL:\");\n                    console.error(createTableSQL);\n                } else {\n                    console.log(\"Jobs table created successfully through insert\");\n                    // Clean up test record\n                    await supabase.from(\"jobs\").delete().eq(\"id\", 0);\n                }\n            } else {\n                console.log(\"Jobs table created successfully through SQL\");\n            }\n        } catch (sqlError) {\n            console.error(\"Error executing SQL:\", sqlError.message);\n        }\n    } catch (error) {\n        console.error(\"Error ensuring jobs table exists:\", error.message);\n    // This error is handled gracefully, we'll just use in-memory storage\n    }\n}\n// Convert string ID to a numeric hash if needed for Supabase compatibility\nfunction getDbCompatibleId(id) {\n    // If the ID is already numeric, return it as is\n    if (!isNaN(Number(id))) {\n        return Number(id);\n    }\n    // Simple hash function to convert string to number \n    // This helps if Supabase table requires numeric IDs\n    let hash = 0;\n    for(let i = 0; i < id.length; i++){\n        const char = id.charCodeAt(i);\n        hash = (hash << 5) - hash + char;\n        hash = hash & hash; // Convert to 32bit integer\n    }\n    // Ensure positive number by using absolute value\n    return Math.abs(hash);\n}\n// Check if Supabase should be used\nfunction shouldUseSupabase() {\n    return isSupabaseConfigured && !supabaseDisabled;\n}\n// Handle Supabase errors consistently\nfunction handleSupabaseError(error) {\n    console.error(\"Supabase operation failed:\", {\n        message: error.message,\n        name: error.name,\n        code: error.code,\n        hint: error.hint,\n        details: error.details,\n        isTypeError: error instanceof TypeError\n    });\n    // If we get a fetch error, disable Supabase for this session\n    if (error instanceof TypeError && (error.message?.includes(\"fetch failed\") || error.message?.includes(\"network error\"))) {\n        console.warn(\"Disabling Supabase due to connectivity issues. Using in-memory storage as fallback.\");\n        supabaseDisabled = true;\n    }\n}\n// Function to create or update a job\nasync function updateJobStatus(jobId, status, data) {\n    // Create in-memory fallback entry\n    const memoryJob = {\n        id: jobId,\n        status: status,\n        result: data?.result || undefined,\n        error: data?.error || undefined,\n        created_at: inMemoryJobs[jobId]?.created_at || new Date().toISOString(),\n        updated_at: new Date().toISOString()\n    };\n    // Save to in-memory store\n    inMemoryJobs[jobId] = memoryJob;\n    // If we shouldn't use Supabase, return early with success\n    if (!shouldUseSupabase()) {\n        return true;\n    }\n    try {\n        const dbId = getDbCompatibleId(jobId);\n        // Ensure result is properly serialized before sending to Supabase\n        let safeResult = null;\n        if (data?.result) {\n            try {\n                // Log coordinates before serialization if they exist\n                if (data.result?.itinerary?.days) {\n                    console.log(\"Checking coordinates before serialization...\");\n                    const days = data.result.itinerary.days;\n                    let hasCoordinateIssues = false;\n                    for(let i = 0; i < days.length; i++){\n                        const day = days[i];\n                        if (day.activities && Array.isArray(day.activities)) {\n                            for(let j = 0; j < day.activities.length; j++){\n                                const activity = day.activities[j];\n                                if (!activity.coordinates || typeof activity.coordinates !== \"object\") {\n                                    console.error(`Missing coordinates in day ${i}, activity ${j}: ${activity.title}`);\n                                    hasCoordinateIssues = true;\n                                } else {\n                                    if (activity.coordinates.lat === undefined || activity.coordinates.lng === undefined) {\n                                        console.error(`Incomplete coordinates in day ${i}, activity ${j}: ${JSON.stringify(activity.coordinates)}`);\n                                        hasCoordinateIssues = true;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    if (!hasCoordinateIssues) {\n                        console.log(\"All coordinates look valid before serialization\");\n                    }\n                }\n                // Test serialization first to catch any issues\n                JSON.stringify(data.result);\n                safeResult = data.result;\n            } catch (e) {\n                console.error(\"Failed to serialize job result to JSON:\", e);\n                safeResult = {\n                    error: \"Result contained unserializable data\"\n                };\n            }\n        }\n        console.log(`Updating job ${jobId} (dbId: ${dbId}) status to ${status}`);\n        // First, get the current job to preserve created_at\n        let created_at = memoryJob.created_at;\n        try {\n            const { data: existingJob } = await supabase.from(\"jobs\").select(\"created_at\").eq(\"id\", dbId).single();\n            if (existingJob?.created_at) {\n                created_at = existingJob.created_at;\n                console.log(`Using existing created_at timestamp: ${created_at}`);\n            } else {\n                console.log(`No existing created_at found, using default created_at: ${created_at}`);\n            }\n        } catch (err) {\n            console.log(`Could not fetch existing job, using default created_at: ${created_at}`);\n        }\n        // Now update with the preserved created_at\n        const { error } = await supabase.from(\"jobs\").upsert({\n            id: dbId,\n            status,\n            result: safeResult,\n            error: data?.error || null,\n            created_at: created_at,\n            updated_at: new Date().toISOString()\n        }, {\n            onConflict: \"id\"\n        });\n        if (error) {\n            console.error(\"Error updating job status in Supabase:\", {\n                code: error.code,\n                message: error.message,\n                details: error.details,\n                jobId,\n                dbId,\n                status\n            });\n        } else {\n            console.log(`Successfully updated job ${jobId} in Supabase`);\n        }\n    } catch (error) {\n        handleSupabaseError(error);\n    }\n    // Always return true since we saved to in-memory storage\n    return true;\n}\n// Function to fetch a job's status\nasync function getJobStatus(jobId) {\n    // Check in-memory first\n    const memoryJob = inMemoryJobs[jobId];\n    // If we shouldn't use Supabase or already have it in memory, return early\n    if (!shouldUseSupabase()) {\n        console.log(`Using in-memory job data for ${jobId}`);\n        return memoryJob || null;\n    }\n    try {\n        const dbId = getDbCompatibleId(jobId);\n        console.log(`Fetching job ${jobId} (dbId: ${dbId}) from Supabase`);\n        // Try by numeric ID\n        const { data, error } = await supabase.from(\"jobs\").select(\"*\").eq(\"id\", dbId).single();\n        if (error) {\n            console.error(\"Error fetching job from Supabase:\", {\n                code: error.code,\n                message: error.message,\n                details: error.details,\n                jobId,\n                dbId\n            });\n            return memoryJob || null;\n        }\n        if (!data) {\n            console.log(`Job ${jobId} not found in Supabase`);\n            return memoryJob || null;\n        }\n        console.log(`Successfully fetched job ${jobId} from Supabase`);\n        // Map data to JobData format\n        return {\n            id: jobId,\n            status: data.status,\n            result: data.result,\n            error: data.error,\n            created_at: data.created_at,\n            updated_at: data.updated_at\n        };\n    } catch (error) {\n        handleSupabaseError(error);\n        return memoryJob || null;\n    }\n}\n// Function to create a new job\nasync function createJob(jobId) {\n    // Create in-memory entry\n    const memoryJob = {\n        id: jobId,\n        status: \"queued\",\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString()\n    };\n    // Save to in-memory store\n    inMemoryJobs[jobId] = memoryJob;\n    // If we shouldn't use Supabase, return early with success\n    if (!shouldUseSupabase()) {\n        console.log(`Created job ${jobId} in memory only (Supabase disabled)`);\n        return true;\n    }\n    try {\n        const dbId = getDbCompatibleId(jobId);\n        console.log(`Creating job ${jobId} (dbId: ${dbId}) in Supabase`);\n        const { error } = await supabase.from(\"jobs\").insert({\n            id: dbId,\n            status: \"queued\",\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n        });\n        if (error) {\n            console.error(\"Error creating job in Supabase:\", {\n                code: error.code,\n                message: error.message,\n                details: error.details,\n                jobId,\n                dbId\n            });\n        } else {\n            console.log(`Successfully created job ${jobId} in Supabase`);\n        }\n    } catch (error) {\n        handleSupabaseError(error);\n    }\n    // Always return true since we saved to in-memory storage\n    return true;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O0lBRUEsSUFBSTtRQUNGLE1BQU1HLE9BQU9sQixrQkFBa0JlO1FBQy9CM0YsUUFBUUMsR0FBRyxDQUFDLENBQUMsYUFBYSxFQUFFMEYsTUFBTSxRQUFRLEVBQUVHLEtBQUssYUFBYSxDQUFDO1FBRS9ELE1BQU0sRUFBRWhELEtBQUssRUFBRSxHQUFHLE1BQU1mLFNBQ3JCZ0IsSUFBSSxDQUFDLFFBQ0xrQixNQUFNLENBQUM7WUFDTkMsSUFBSTRCO1lBQ0ozQixRQUFRO1lBQ1JFLFlBQVksSUFBSUMsT0FBT0MsV0FBVztZQUNsQ0MsWUFBWSxJQUFJRixPQUFPQyxXQUFXO1FBQ3BDO1FBRUYsSUFBSXpCLE9BQU87WUFDVDlDLFFBQVE4QyxLQUFLLENBQUMsbUNBQW1DO2dCQUMvQ0ksTUFBTUosTUFBTUksSUFBSTtnQkFDaEJQLFNBQVNHLE1BQU1ILE9BQU87Z0JBQ3RCUyxTQUFTTixNQUFNTSxPQUFPO2dCQUN0QnVDO2dCQUNBRztZQUNGO1FBQ0YsT0FBTztZQUNMOUYsUUFBUUMsR0FBRyxDQUFDLENBQUMseUJBQXlCLEVBQUUwRixNQUFNLFlBQVksQ0FBQztRQUM3RDtJQUNGLEVBQUUsT0FBTzdDLE9BQU87UUFDZHdDLG9CQUFvQnhDO0lBQ3RCO0lBRUEseURBQXlEO0lBQ3pELE9BQU87QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovL2FpLXRyYXZlbC1hZ2VudC8uL2xpYi9zdXBhYmFzZS50cz9jOTlmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5cbi8vIEV4cGxpY2l0bHkgbG9nIGFsbCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgZm9yIGRlYnVnZ2luZ1xuY29uc29sZS5sb2coJ05PREVfRU5WOicsIHByb2Nlc3MuZW52Lk5PREVfRU5WKTtcbmNvbnNvbGUubG9nKCdFbnZpcm9ubWVudCBWYXJpYWJsZXMgT3ZlcnZpZXc6Jywge1xuICBoYXNQcm9jZXNzRW52OiB0eXBlb2YgcHJvY2VzcyAhPT0gJ3VuZGVmaW5lZCcgJiYgISFwcm9jZXNzLmVudixcbiAgbm9kZUVudjogcHJvY2Vzcy5lbnYuTk9ERV9FTlYsXG4gIGhhc1NiVXJsOiAnTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMJyBpbiBwcm9jZXNzLmVudixcbiAgaGFzU2JLZXk6ICdORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWScgaW4gcHJvY2Vzcy5lbnYsXG4gIG5leHRDb25maWc6IHR5cGVvZiBwcm9jZXNzLmVudi5ORVhUX0NPTkZJR19BVkFJTEFCTEUgPT09ICdzdHJpbmcnLFxuICBlbnZWYXJDb3VudDogT2JqZWN0LmtleXMocHJvY2Vzcy5lbnYpLmZpbHRlcihrZXkgPT4ga2V5LnN0YXJ0c1dpdGgoJ05FWFRfJykpLmxlbmd0aFxufSk7XG5cbi8vIFN1cGFiYXNlIGNsaWVudCBzZXR1cFxuLy8gRGlyZWN0bHkgYWNjZXNzIHZhcmlhYmxlcyBmb3IgZGVidWdnaW5nIHJhdGhlciB0aGFuIHVzaW5nIHx8ICcnIHBhdHRlcm4gaW5pdGlhbGx5XG5sZXQgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XG5sZXQgc3VwYWJhc2VBbm9uS2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVk7XG5cbi8vIERlYnVnIFN1cGFiYXNlIHNldHVwIHdpdGhvdXQgZXhwb3Npbmcga2V5c1xuY29uc29sZS5sb2coJ0RpcmVjdCBTdXBhYmFzZSBVUkw6Jywgc3VwYWJhc2VVcmw/LnN1YnN0cmluZygwLCAxMikgKyAnLi4uJyB8fCAndW5kZWZpbmVkJyk7XG5jb25zb2xlLmxvZygnRGlyZWN0IFN1cGFiYXNlIEtleTonLCBzdXBhYmFzZUFub25LZXk/LnN1YnN0cmluZygwLCA2KSArICcuLi4nIHx8ICd1bmRlZmluZWQnKTtcblxuLy8gRmFsbGJhY2sgdG8gZW1wdHkgc3RyaW5nIGlmIHVuZGVmaW5lZFxuc3VwYWJhc2VVcmwgPSBzdXBhYmFzZVVybCB8fCAnJztcbnN1cGFiYXNlQW5vbktleSA9IHN1cGFiYXNlQW5vbktleSB8fCAnJztcblxuLy8gRGVidWcgU3VwYWJhc2Ugc2V0dXAgd2l0aG91dCBleHBvc2luZyBrZXlzXG5jb25zb2xlLmxvZygnU3VwYWJhc2UgY29uZmlndXJhdGlvbiBjaGVjazonLCB7XG4gIGhhc1VybDogQm9vbGVhbihzdXBhYmFzZVVybCksXG4gIHVybExlbmd0aDogc3VwYWJhc2VVcmw/Lmxlbmd0aCB8fCAwLFxuICB1cmxQcmVmaXg6IHN1cGFiYXNlVXJsPy5zdWJzdHJpbmcoMCwgOCkgfHwgJycsXG4gIGhhc0tleTogQm9vbGVhbihzdXBhYmFzZUFub25LZXkpLFxuICBrZXlMZW5ndGg6IHN1cGFiYXNlQW5vbktleT8ubGVuZ3RoIHx8IDAsXG4gIGtleVByZWZpeDogc3VwYWJhc2VBbm9uS2V5Py5zdWJzdHJpbmcoMCwgNCkgfHwgJydcbn0pO1xuXG4vLyBUeXBlIGRlZmluaXRpb24gZm9yIGpvYiBkYXRhXG5leHBvcnQgdHlwZSBKb2JEYXRhID0ge1xuICBpZDogc3RyaW5nO1xuICBzdGF0dXM6ICdxdWV1ZWQnIHwgJ3Byb2Nlc3NpbmcnIHwgJ2NvbXBsZXRlZCcgfCAnZmFpbGVkJztcbiAgcmVzdWx0PzogYW55O1xuICBlcnJvcj86IHN0cmluZztcbiAgY3JlYXRlZF9hdD86IHN0cmluZztcbiAgdXBkYXRlZF9hdDogc3RyaW5nO1xufTtcblxuLy8gQ2hlY2sgaWYgU3VwYWJhc2UgaXMgY29uZmlndXJlZCBwcm9wZXJseVxuY29uc3QgaXNTdXBhYmFzZUNvbmZpZ3VyZWQgPSBCb29sZWFuKHN1cGFiYXNlVXJsICYmIHN1cGFiYXNlQW5vbktleSk7XG5cbi8vIEluLW1lbW9yeSBzdG9yZSB0byB0cmFjayBpZiBTdXBhYmFzZSBjb25uZWN0aXZpdHkgZmFpbGVkIGR1cmluZyBydW50aW1lXG5sZXQgc3VwYWJhc2VEaXNhYmxlZCA9IGZhbHNlO1xuXG4vLyBJbml0aWFsaXplIHRoZSBTdXBhYmFzZSBjbGllbnQgd2l0aCBleHBsaWNpdCBvcHRpb25zIGZvciBiZXR0ZXIgcmVsaWFiaWxpdHlcbmV4cG9ydCBjb25zdCBzdXBhYmFzZSA9IGlzU3VwYWJhc2VDb25maWd1cmVkXG4gID8gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXksIHtcbiAgICAgIGF1dGg6IHtcbiAgICAgICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxuICAgICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgICBnbG9iYWw6IHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBkYjoge1xuICAgICAgICBzY2hlbWE6ICdwdWJsaWMnXG4gICAgICB9XG4gICAgfSlcbiAgOiBjcmVhdGVDbGllbnQoJ2h0dHBzOi8vcGxhY2Vob2xkZXItdXJsLnN1cGFiYXNlLmNvJywgJ3BsYWNlaG9sZGVyLWtleScsIHtcbiAgICAgIGF1dGg6IHtcbiAgICAgICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxuICAgICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbi8vIExvZyBpbml0aWFsaXphdGlvbiBzdGF0dXNcbmlmICghaXNTdXBhYmFzZUNvbmZpZ3VyZWQpIHtcbiAgY29uc29sZS5sb2coJ1N1cGFiYXNlIG5vdCBwcm9wZXJseSBjb25maWd1cmVkLiBVc2luZyBpbi1tZW1vcnkgam9iIHN0b3JhZ2UgYXMgZmFsbGJhY2suJyk7XG59IGVsc2Uge1xuICBjb25zb2xlLmxvZygnU3VwYWJhc2UgY2xpZW50IGluaXRpYWxpemVkLCB2ZXJpZnlpbmcgY29ubmVjdGlvbi4uLicpO1xuICAvLyBBdHRlbXB0IHRvIHZlcmlmeSBjb25uZWN0aW9uIGFuZCBlbnN1cmUgdGhlIGpvYnMgdGFibGUgZXhpc3RzXG4gIHZlcmlmeVN1cGFiYXNlQ29ubmVjdGlvbigpLmNhdGNoKGVyciA9PiB7XG4gICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gdmVyaWZ5IFN1cGFiYXNlIGNvbm5lY3Rpb246JywgZXJyLm1lc3NhZ2UpO1xuICB9KTtcbn1cblxuLy8gSW4tbWVtb3J5IGZhbGxiYWNrIHN0b3JlIGZvciBkZXZlbG9wbWVudCBvciB3aGVuIFN1cGFiYXNlIGlzbid0IGNvbmZpZ3VyZWRcbmNvbnN0IGluTWVtb3J5Sm9iczogUmVjb3JkPHN0cmluZywgSm9iRGF0YT4gPSB7fTtcblxuLy8gRnVuY3Rpb24gdG8gdmVyaWZ5IHRoZSBTdXBhYmFzZSBjb25uZWN0aW9uXG5hc3luYyBmdW5jdGlvbiB2ZXJpZnlTdXBhYmFzZUNvbm5lY3Rpb24oKSB7XG4gIGlmICghaXNTdXBhYmFzZUNvbmZpZ3VyZWQpIHJldHVybjtcbiAgXG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coJ0NoZWNraW5nIFN1cGFiYXNlIGNvbm5lY3Rpb24uLi4nKTtcbiAgICBcbiAgICAvLyBGaXJzdCB0cnkgdG8gZGlyZWN0bHkgcXVlcnkgaWYgdGhlIGpvYnMgdGFibGUgZXhpc3RzXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdqb2JzJylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmxpbWl0KDEpO1xuICAgIFxuICAgIGlmIChlcnJvcikge1xuICAgICAgLy8gVGFibGUgbWlnaHQgbm90IGV4aXN0XG4gICAgICBpZiAoZXJyb3IuY29kZSA9PT0gJzQyUDAxJykge1xuICAgICAgICBjb25zb2xlLmxvZygnSm9icyB0YWJsZSBkb2VzIG5vdCBleGlzdCwgd2lsbCBhdHRlbXB0IHRvIGNyZWF0ZSBpdCcpO1xuICAgICAgICBhd2FpdCBlbnN1cmVKb2JzVGFibGVFeGlzdHMoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1N1cGFiYXNlIGNvbm5lY3Rpb24gdmVyaWZpY2F0aW9uIGZhaWxlZDonLCB7XG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgICBjb2RlOiBlcnJvci5jb2RlLFxuICAgICAgICAgIGRldGFpbHM6IGVycm9yLmRldGFpbHNcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKCdTdXBhYmFzZSBjb25uZWN0aW9uIHZlcmlmaWVkIHN1Y2Nlc3NmdWxseSwgam9icyB0YWJsZSBleGlzdHMnKTtcbiAgICAgIC8vIENoZWNrIHRvIHNlZSBpZiB3ZSBoYXZlIHRoZSByaWdodCBjb2x1bW5zXG4gICAgICBhd2FpdCBjaGVja1RhYmxlU3RydWN0dXJlKGRhdGEpO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHZlcmlmeWluZyBTdXBhYmFzZSBjb25uZWN0aW9uOicsIHtcbiAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICBzdGFjazogZXJyb3Iuc3RhY2s/LnN1YnN0cmluZygwLCAyMDApXG4gICAgfSk7XG4gICAgXG4gICAgLy8gSWYgdGhpcyBpcyBhIG5ldHdvcmsgZXJyb3IsIGRpc2FibGUgU3VwYWJhc2VcbiAgICBpZiAoZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ2ZldGNoIGZhaWxlZCcpIHx8IFxuICAgICAgICBlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnbmV0d29yayBlcnJvcicpIHx8XG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgVHlwZUVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0Rpc2FibGluZyBTdXBhYmFzZSBkdWUgdG8gY29ubmVjdGlvbiBpc3N1ZXMnKTtcbiAgICAgIHN1cGFiYXNlRGlzYWJsZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxufVxuXG4vLyBDaGVjayBhbmQgYWRhcHQgdG8gZXhpc3RpbmcgdGFibGUgc3RydWN0dXJlXG5hc3luYyBmdW5jdGlvbiBjaGVja1RhYmxlU3RydWN0dXJlKHNhbXBsZURhdGE6IGFueVtdKSB7XG4gIGlmIChzYW1wbGVEYXRhICYmIHNhbXBsZURhdGEubGVuZ3RoID4gMCkge1xuICAgIC8vIExvZyB0aGUgc3RydWN0dXJlIHdlIGZvdW5kIGZvciBkZWJ1Z2dpbmdcbiAgICBjb25zdCBmaXJzdFJvdyA9IHNhbXBsZURhdGFbMF07XG4gICAgY29uc29sZS5sb2coJ0ZvdW5kIGV4aXN0aW5nIGpvYnMgdGFibGUgd2l0aCBjb2x1bW5zOicsIE9iamVjdC5rZXlzKGZpcnN0Um93KS5qb2luKCcsICcpKTtcbiAgfVxufVxuXG4vLyBGdW5jdGlvbiB0byBjaGVjayBhbmQgY3JlYXRlIHRoZSBqb2JzIHRhYmxlIGlmIGl0IGRvZXNuJ3QgZXhpc3RcbmFzeW5jIGZ1bmN0aW9uIGVuc3VyZUpvYnNUYWJsZUV4aXN0cygpIHtcbiAgaWYgKCFpc1N1cGFiYXNlQ29uZmlndXJlZCkgcmV0dXJuO1xuICBcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygnQXR0ZW1wdGluZyB0byBjcmVhdGUgam9icyB0YWJsZS4uLicpO1xuICAgIFxuICAgIC8vIENoZWNrIGlmIHdlIGhhdmUgcGVybWlzc2lvbiB0byBleGVjdXRlIFNRTFxuICAgIHRyeSB7XG4gICAgICAvLyBGaXJzdCwgdHJ5IHRvIGNyZWF0ZSBhIHNpbXBsZSB0YWJsZSB3aXRoIHRoZSBtaW5pbXVtIHJlcXVpcmVkIGZpZWxkc1xuICAgICAgY29uc3QgY3JlYXRlVGFibGVTUUwgPSBgXG4gICAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGpvYnMgKFxuICAgICAgICAgIGlkIEJJR0lOVCBQUklNQVJZIEtFWSxcbiAgICAgICAgICBzdGF0dXMgVEVYVCxcbiAgICAgICAgICByZXN1bHQgSlNPTkIsXG4gICAgICAgICAgZXJyb3IgVEVYVCxcbiAgICAgICAgICBjcmVhdGVkX2F0IFRJTUVTVEFNUCBXSVRIIFRJTUUgWk9ORSBERUZBVUxUIE5PVygpLFxuICAgICAgICAgIHVwZGF0ZWRfYXQgVElNRVNUQU1QIFdJVEggVElNRSBaT05FIERFRkFVTFQgTk9XKClcbiAgICAgICAgKTtcbiAgICAgIGA7XG4gICAgICBcbiAgICAgIGNvbnN0IHsgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5ycGMoJ2V4ZWN1dGVfc3FsJywgeyBzcWw6IGNyZWF0ZVRhYmxlU1FMIH0pO1xuICAgICAgXG4gICAgICBpZiAoY3JlYXRlRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBqb2JzIHRhYmxlIHZpYSBTUUw6JywgY3JlYXRlRXJyb3IpO1xuICAgICAgICBcbiAgICAgICAgLy8gVHJ5IGFuIGFsdGVybmF0aXZlIGFwcHJvYWNoIC0gdXNpbmcgdGhlIGluc2VydCBBUElcbiAgICAgICAgY29uc29sZS5sb2coJ1RyeWluZyB0byBjcmVhdGUgam9icyB0YWJsZSB2aWEgaW5zZXJ0Li4uJyk7XG4gICAgICAgIGNvbnN0IHsgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgIC5mcm9tKCdqb2JzJylcbiAgICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICAgIGlkOiAwLFxuICAgICAgICAgICAgc3RhdHVzOiAndGVzdCcsXG4gICAgICAgICAgICByZXN1bHQ6IG51bGwsXG4gICAgICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcbiAgICAgICAgICAvLyBJZiBTdXBhYmFzZSBkb2Vzbid0IGxldCB1cyBjcmVhdGUgdGhlIHRhYmxlLCBsb2cgd2hhdCBuZWVkcyB0byBiZSBjcmVhdGVkXG4gICAgICAgICAgY29uc29sZS5lcnJvcignQ2Fubm90IGNyZWF0ZSBqb2JzIHRhYmxlIGF1dG9tYXRpY2FsbHk6JywgaW5zZXJ0RXJyb3IpO1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1BsZWFzZSBjcmVhdGUgdGhlIGpvYnMgdGFibGUgbWFudWFsbHkgd2l0aCB0aGlzIFNRTDonKTtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGNyZWF0ZVRhYmxlU1FMKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnSm9icyB0YWJsZSBjcmVhdGVkIHN1Y2Nlc3NmdWxseSB0aHJvdWdoIGluc2VydCcpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIENsZWFuIHVwIHRlc3QgcmVjb3JkXG4gICAgICAgICAgYXdhaXQgc3VwYWJhc2UuZnJvbSgnam9icycpLmRlbGV0ZSgpLmVxKCdpZCcsIDApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZygnSm9icyB0YWJsZSBjcmVhdGVkIHN1Y2Nlc3NmdWxseSB0aHJvdWdoIFNRTCcpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKHNxbEVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGV4ZWN1dGluZyBTUUw6Jywgc3FsRXJyb3IubWVzc2FnZSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZW5zdXJpbmcgam9icyB0YWJsZSBleGlzdHM6JywgZXJyb3IubWVzc2FnZSk7XG4gICAgLy8gVGhpcyBlcnJvciBpcyBoYW5kbGVkIGdyYWNlZnVsbHksIHdlJ2xsIGp1c3QgdXNlIGluLW1lbW9yeSBzdG9yYWdlXG4gIH1cbn1cblxuLy8gQ29udmVydCBzdHJpbmcgSUQgdG8gYSBudW1lcmljIGhhc2ggaWYgbmVlZGVkIGZvciBTdXBhYmFzZSBjb21wYXRpYmlsaXR5XG5mdW5jdGlvbiBnZXREYkNvbXBhdGlibGVJZChpZDogc3RyaW5nKTogbnVtYmVyIHtcbiAgLy8gSWYgdGhlIElEIGlzIGFscmVhZHkgbnVtZXJpYywgcmV0dXJuIGl0IGFzIGlzXG4gIGlmICghaXNOYU4oTnVtYmVyKGlkKSkpIHtcbiAgICByZXR1cm4gTnVtYmVyKGlkKTtcbiAgfVxuICBcbiAgLy8gU2ltcGxlIGhhc2ggZnVuY3Rpb24gdG8gY29udmVydCBzdHJpbmcgdG8gbnVtYmVyIFxuICAvLyBUaGlzIGhlbHBzIGlmIFN1cGFiYXNlIHRhYmxlIHJlcXVpcmVzIG51bWVyaWMgSURzXG4gIGxldCBoYXNoID0gMDtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBpZC5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGNoYXIgPSBpZC5jaGFyQ29kZUF0KGkpO1xuICAgIGhhc2ggPSAoKGhhc2ggPDwgNSkgLSBoYXNoKSArIGNoYXI7XG4gICAgaGFzaCA9IGhhc2ggJiBoYXNoOyAvLyBDb252ZXJ0IHRvIDMyYml0IGludGVnZXJcbiAgfVxuICBcbiAgLy8gRW5zdXJlIHBvc2l0aXZlIG51bWJlciBieSB1c2luZyBhYnNvbHV0ZSB2YWx1ZVxuICByZXR1cm4gTWF0aC5hYnMoaGFzaCk7XG59XG5cbi8vIENoZWNrIGlmIFN1cGFiYXNlIHNob3VsZCBiZSB1c2VkXG5mdW5jdGlvbiBzaG91bGRVc2VTdXBhYmFzZSgpOiBib29sZWFuIHtcbiAgcmV0dXJuIGlzU3VwYWJhc2VDb25maWd1cmVkICYmICFzdXBhYmFzZURpc2FibGVkO1xufVxuXG4vLyBIYW5kbGUgU3VwYWJhc2UgZXJyb3JzIGNvbnNpc3RlbnRseVxuZnVuY3Rpb24gaGFuZGxlU3VwYWJhc2VFcnJvcihlcnJvcjogYW55KTogdm9pZCB7XG4gIGNvbnNvbGUuZXJyb3IoJ1N1cGFiYXNlIG9wZXJhdGlvbiBmYWlsZWQ6Jywge1xuICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgbmFtZTogZXJyb3IubmFtZSxcbiAgICBjb2RlOiBlcnJvci5jb2RlLFxuICAgIGhpbnQ6IGVycm9yLmhpbnQsXG4gICAgZGV0YWlsczogZXJyb3IuZGV0YWlscyxcbiAgICBpc1R5cGVFcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBUeXBlRXJyb3JcbiAgfSk7XG4gIFxuICAvLyBJZiB3ZSBnZXQgYSBmZXRjaCBlcnJvciwgZGlzYWJsZSBTdXBhYmFzZSBmb3IgdGhpcyBzZXNzaW9uXG4gIGlmIChlcnJvciBpbnN0YW5jZW9mIFR5cGVFcnJvciAmJiBcbiAgICAgIChlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnZmV0Y2ggZmFpbGVkJykgfHwgZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ25ldHdvcmsgZXJyb3InKSkpIHtcbiAgICBjb25zb2xlLndhcm4oJ0Rpc2FibGluZyBTdXBhYmFzZSBkdWUgdG8gY29ubmVjdGl2aXR5IGlzc3Vlcy4gVXNpbmcgaW4tbWVtb3J5IHN0b3JhZ2UgYXMgZmFsbGJhY2suJyk7XG4gICAgc3VwYWJhc2VEaXNhYmxlZCA9IHRydWU7XG4gIH1cbn1cblxuLy8gRnVuY3Rpb24gdG8gY3JlYXRlIG9yIHVwZGF0ZSBhIGpvYlxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUpvYlN0YXR1cyhcbiAgam9iSWQ6IHN0cmluZywgXG4gIHN0YXR1czogc3RyaW5nLCBcbiAgZGF0YT86IHsgcmVzdWx0PzogYW55OyBlcnJvcj86IHN0cmluZyB9XG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgLy8gQ3JlYXRlIGluLW1lbW9yeSBmYWxsYmFjayBlbnRyeVxuICBjb25zdCBtZW1vcnlKb2I6IEpvYkRhdGEgPSB7XG4gICAgaWQ6IGpvYklkLFxuICAgIHN0YXR1czogc3RhdHVzIGFzIGFueSxcbiAgICByZXN1bHQ6IGRhdGE/LnJlc3VsdCB8fCB1bmRlZmluZWQsXG4gICAgZXJyb3I6IGRhdGE/LmVycm9yIHx8IHVuZGVmaW5lZCxcbiAgICBjcmVhdGVkX2F0OiBpbk1lbW9yeUpvYnNbam9iSWRdPy5jcmVhdGVkX2F0IHx8IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgfTtcblxuICAvLyBTYXZlIHRvIGluLW1lbW9yeSBzdG9yZVxuICBpbk1lbW9yeUpvYnNbam9iSWRdID0gbWVtb3J5Sm9iO1xuXG4gIC8vIElmIHdlIHNob3VsZG4ndCB1c2UgU3VwYWJhc2UsIHJldHVybiBlYXJseSB3aXRoIHN1Y2Nlc3NcbiAgaWYgKCFzaG91bGRVc2VTdXBhYmFzZSgpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IGRiSWQgPSBnZXREYkNvbXBhdGlibGVJZChqb2JJZCk7XG4gICAgXG4gICAgLy8gRW5zdXJlIHJlc3VsdCBpcyBwcm9wZXJseSBzZXJpYWxpemVkIGJlZm9yZSBzZW5kaW5nIHRvIFN1cGFiYXNlXG4gICAgbGV0IHNhZmVSZXN1bHQgPSBudWxsO1xuICAgIGlmIChkYXRhPy5yZXN1bHQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIExvZyBjb29yZGluYXRlcyBiZWZvcmUgc2VyaWFsaXphdGlvbiBpZiB0aGV5IGV4aXN0XG4gICAgICAgIGlmIChkYXRhLnJlc3VsdD8uaXRpbmVyYXJ5Py5kYXlzKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ0NoZWNraW5nIGNvb3JkaW5hdGVzIGJlZm9yZSBzZXJpYWxpemF0aW9uLi4uJyk7XG4gICAgICAgICAgY29uc3QgZGF5cyA9IGRhdGEucmVzdWx0Lml0aW5lcmFyeS5kYXlzO1xuICAgICAgICAgIGxldCBoYXNDb29yZGluYXRlSXNzdWVzID0gZmFsc2U7XG4gICAgICAgICAgXG4gICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBkYXkgPSBkYXlzW2ldO1xuICAgICAgICAgICAgaWYgKGRheS5hY3Rpdml0aWVzICYmIEFycmF5LmlzQXJyYXkoZGF5LmFjdGl2aXRpZXMpKSB7XG4gICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgZGF5LmFjdGl2aXRpZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhY3Rpdml0eSA9IGRheS5hY3Rpdml0aWVzW2pdO1xuICAgICAgICAgICAgICAgIGlmICghYWN0aXZpdHkuY29vcmRpbmF0ZXMgfHwgdHlwZW9mIGFjdGl2aXR5LmNvb3JkaW5hdGVzICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgTWlzc2luZyBjb29yZGluYXRlcyBpbiBkYXkgJHtpfSwgYWN0aXZpdHkgJHtqfTogJHthY3Rpdml0eS50aXRsZX1gKTtcbiAgICAgICAgICAgICAgICAgIGhhc0Nvb3JkaW5hdGVJc3N1ZXMgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBpZiAoYWN0aXZpdHkuY29vcmRpbmF0ZXMubGF0ID09PSB1bmRlZmluZWQgfHwgYWN0aXZpdHkuY29vcmRpbmF0ZXMubG5nID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgSW5jb21wbGV0ZSBjb29yZGluYXRlcyBpbiBkYXkgJHtpfSwgYWN0aXZpdHkgJHtqfTogJHtKU09OLnN0cmluZ2lmeShhY3Rpdml0eS5jb29yZGluYXRlcyl9YCk7XG4gICAgICAgICAgICAgICAgICAgIGhhc0Nvb3JkaW5hdGVJc3N1ZXMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoIWhhc0Nvb3JkaW5hdGVJc3N1ZXMpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBbGwgY29vcmRpbmF0ZXMgbG9vayB2YWxpZCBiZWZvcmUgc2VyaWFsaXphdGlvbicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gVGVzdCBzZXJpYWxpemF0aW9uIGZpcnN0IHRvIGNhdGNoIGFueSBpc3N1ZXNcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoZGF0YS5yZXN1bHQpO1xuICAgICAgICBzYWZlUmVzdWx0ID0gZGF0YS5yZXN1bHQ7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzZXJpYWxpemUgam9iIHJlc3VsdCB0byBKU09OOicsIGUpO1xuICAgICAgICBzYWZlUmVzdWx0ID0geyBlcnJvcjogJ1Jlc3VsdCBjb250YWluZWQgdW5zZXJpYWxpemFibGUgZGF0YScgfTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coYFVwZGF0aW5nIGpvYiAke2pvYklkfSAoZGJJZDogJHtkYklkfSkgc3RhdHVzIHRvICR7c3RhdHVzfWApO1xuICAgIFxuICAgIC8vIEZpcnN0LCBnZXQgdGhlIGN1cnJlbnQgam9iIHRvIHByZXNlcnZlIGNyZWF0ZWRfYXRcbiAgICBsZXQgY3JlYXRlZF9hdCA9IG1lbW9yeUpvYi5jcmVhdGVkX2F0O1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgnam9icycpXG4gICAgICAgIC5zZWxlY3QoJ2NyZWF0ZWRfYXQnKVxuICAgICAgICAuZXEoJ2lkJywgZGJJZClcbiAgICAgICAgLnNpbmdsZSgpO1xuICAgICAgXG4gICAgICBpZiAoZXhpc3RpbmdKb2I/LmNyZWF0ZWRfYXQpIHtcbiAgICAgICAgY3JlYXRlZF9hdCA9IGV4aXN0aW5nSm9iLmNyZWF0ZWRfYXQ7XG4gICAgICAgIGNvbnNvbGUubG9nKGBVc2luZyBleGlzdGluZyBjcmVhdGVkX2F0IHRpbWVzdGFtcDogJHtjcmVhdGVkX2F0fWApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coYE5vIGV4aXN0aW5nIGNyZWF0ZWRfYXQgZm91bmQsIHVzaW5nIGRlZmF1bHQgY3JlYXRlZF9hdDogJHtjcmVhdGVkX2F0fWApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5sb2coYENvdWxkIG5vdCBmZXRjaCBleGlzdGluZyBqb2IsIHVzaW5nIGRlZmF1bHQgY3JlYXRlZF9hdDogJHtjcmVhdGVkX2F0fWApO1xuICAgIH1cbiAgICBcbiAgICAvLyBOb3cgdXBkYXRlIHdpdGggdGhlIHByZXNlcnZlZCBjcmVhdGVkX2F0XG4gICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdqb2JzJylcbiAgICAgIC51cHNlcnQoe1xuICAgICAgICBpZDogZGJJZCxcbiAgICAgICAgc3RhdHVzLFxuICAgICAgICByZXN1bHQ6IHNhZmVSZXN1bHQsXG4gICAgICAgIGVycm9yOiBkYXRhPy5lcnJvciB8fCBudWxsLFxuICAgICAgICBjcmVhdGVkX2F0OiBjcmVhdGVkX2F0LFxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH0sIHtcbiAgICAgICAgb25Db25mbGljdDogJ2lkJ1xuICAgICAgfSk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIGpvYiBzdGF0dXMgaW4gU3VwYWJhc2U6Jywge1xuICAgICAgICBjb2RlOiBlcnJvci5jb2RlLFxuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICBkZXRhaWxzOiBlcnJvci5kZXRhaWxzLFxuICAgICAgICBqb2JJZCxcbiAgICAgICAgZGJJZCxcbiAgICAgICAgc3RhdHVzXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coYFN1Y2Nlc3NmdWxseSB1cGRhdGVkIGpvYiAke2pvYklkfSBpbiBTdXBhYmFzZWApO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBoYW5kbGVTdXBhYmFzZUVycm9yKGVycm9yKTtcbiAgfVxuICBcbiAgLy8gQWx3YXlzIHJldHVybiB0cnVlIHNpbmNlIHdlIHNhdmVkIHRvIGluLW1lbW9yeSBzdG9yYWdlXG4gIHJldHVybiB0cnVlO1xufVxuXG4vLyBGdW5jdGlvbiB0byBmZXRjaCBhIGpvYidzIHN0YXR1c1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEpvYlN0YXR1cyhqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxKb2JEYXRhIHwgbnVsbD4ge1xuICAvLyBDaGVjayBpbi1tZW1vcnkgZmlyc3RcbiAgY29uc3QgbWVtb3J5Sm9iID0gaW5NZW1vcnlKb2JzW2pvYklkXTtcblxuICAvLyBJZiB3ZSBzaG91bGRuJ3QgdXNlIFN1cGFiYXNlIG9yIGFscmVhZHkgaGF2ZSBpdCBpbiBtZW1vcnksIHJldHVybiBlYXJseVxuICBpZiAoIXNob3VsZFVzZVN1cGFiYXNlKCkpIHtcbiAgICBjb25zb2xlLmxvZyhgVXNpbmcgaW4tbWVtb3J5IGpvYiBkYXRhIGZvciAke2pvYklkfWApO1xuICAgIHJldHVybiBtZW1vcnlKb2IgfHwgbnVsbDtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgZGJJZCA9IGdldERiQ29tcGF0aWJsZUlkKGpvYklkKTtcbiAgICBjb25zb2xlLmxvZyhgRmV0Y2hpbmcgam9iICR7am9iSWR9IChkYklkOiAke2RiSWR9KSBmcm9tIFN1cGFiYXNlYCk7XG4gICAgXG4gICAgLy8gVHJ5IGJ5IG51bWVyaWMgSURcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ2pvYnMnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuZXEoJ2lkJywgZGJJZClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgam9iIGZyb20gU3VwYWJhc2U6Jywge1xuICAgICAgICBjb2RlOiBlcnJvci5jb2RlLFxuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICBkZXRhaWxzOiBlcnJvci5kZXRhaWxzLFxuICAgICAgICBqb2JJZCxcbiAgICAgICAgZGJJZFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gbWVtb3J5Sm9iIHx8IG51bGw7XG4gICAgfVxuICAgIFxuICAgIGlmICghZGF0YSkge1xuICAgICAgY29uc29sZS5sb2coYEpvYiAke2pvYklkfSBub3QgZm91bmQgaW4gU3VwYWJhc2VgKTtcbiAgICAgIHJldHVybiBtZW1vcnlKb2IgfHwgbnVsbDtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhgU3VjY2Vzc2Z1bGx5IGZldGNoZWQgam9iICR7am9iSWR9IGZyb20gU3VwYWJhc2VgKTtcbiAgICBcbiAgICAvLyBNYXAgZGF0YSB0byBKb2JEYXRhIGZvcm1hdFxuICAgIHJldHVybiB7XG4gICAgICBpZDogam9iSWQsIC8vIFVzZSB0aGUgb3JpZ2luYWwgc3RyaW5nIElEIGZvciBjb25zaXN0ZW5jeVxuICAgICAgc3RhdHVzOiBkYXRhLnN0YXR1cyxcbiAgICAgIHJlc3VsdDogZGF0YS5yZXN1bHQsXG4gICAgICBlcnJvcjogZGF0YS5lcnJvcixcbiAgICAgIGNyZWF0ZWRfYXQ6IGRhdGEuY3JlYXRlZF9hdCxcbiAgICAgIHVwZGF0ZWRfYXQ6IGRhdGEudXBkYXRlZF9hdFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgaGFuZGxlU3VwYWJhc2VFcnJvcihlcnJvcik7XG4gICAgcmV0dXJuIG1lbW9yeUpvYiB8fCBudWxsO1xuICB9XG59XG5cbi8vIEZ1bmN0aW9uIHRvIGNyZWF0ZSBhIG5ldyBqb2JcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAvLyBDcmVhdGUgaW4tbWVtb3J5IGVudHJ5XG4gIGNvbnN0IG1lbW9yeUpvYjogSm9iRGF0YSA9IHtcbiAgICBpZDogam9iSWQsXG4gICAgc3RhdHVzOiAncXVldWVkJyxcbiAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gIH07XG4gIFxuICAvLyBTYXZlIHRvIGluLW1lbW9yeSBzdG9yZVxuICBpbk1lbW9yeUpvYnNbam9iSWRdID0gbWVtb3J5Sm9iO1xuXG4gIC8vIElmIHdlIHNob3VsZG4ndCB1c2UgU3VwYWJhc2UsIHJldHVybiBlYXJseSB3aXRoIHN1Y2Nlc3NcbiAgaWYgKCFzaG91bGRVc2VTdXBhYmFzZSgpKSB7XG4gICAgY29uc29sZS5sb2coYENyZWF0ZWQgam9iICR7am9iSWR9IGluIG1lbW9yeSBvbmx5IChTdXBhYmFzZSBkaXNhYmxlZClgKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgZGJJZCA9IGdldERiQ29tcGF0aWJsZUlkKGpvYklkKTtcbiAgICBjb25zb2xlLmxvZyhgQ3JlYXRpbmcgam9iICR7am9iSWR9IChkYklkOiAke2RiSWR9KSBpbiBTdXBhYmFzZWApO1xuICAgIFxuICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnam9icycpXG4gICAgICAuaW5zZXJ0KHtcbiAgICAgICAgaWQ6IGRiSWQsXG4gICAgICAgIHN0YXR1czogJ3F1ZXVlZCcsXG4gICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9KTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgam9iIGluIFN1cGFiYXNlOicsIHtcbiAgICAgICAgY29kZTogZXJyb3IuY29kZSxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgZGV0YWlsczogZXJyb3IuZGV0YWlscyxcbiAgICAgICAgam9iSWQsXG4gICAgICAgIGRiSWRcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhgU3VjY2Vzc2Z1bGx5IGNyZWF0ZWQgam9iICR7am9iSWR9IGluIFN1cGFiYXNlYCk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGhhbmRsZVN1cGFiYXNlRXJyb3IoZXJyb3IpO1xuICB9XG4gIFxuICAvLyBBbHdheXMgcmV0dXJuIHRydWUgc2luY2Ugd2Ugc2F2ZWQgdG8gaW4tbWVtb3J5IHN0b3JhZ2VcbiAgcmV0dXJuIHRydWU7XG59ICJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJjb25zb2xlIiwibG9nIiwiaGFzUHJvY2Vzc0VudiIsInByb2Nlc3MiLCJlbnYiLCJub2RlRW52IiwiaGFzU2JVcmwiLCJoYXNTYktleSIsIm5leHRDb25maWciLCJORVhUX0NPTkZJR19BVkFJTEFCTEUiLCJlbnZWYXJDb3VudCIsIk9iamVjdCIsImtleXMiLCJmaWx0ZXIiLCJrZXkiLCJzdGFydHNXaXRoIiwibGVuZ3RoIiwic3VwYWJhc2VVcmwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzdXBhYmFzZUFub25LZXkiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsInN1YnN0cmluZyIsImhhc1VybCIsIkJvb2xlYW4iLCJ1cmxMZW5ndGgiLCJ1cmxQcmVmaXgiLCJoYXNLZXkiLCJrZXlMZW5ndGgiLCJrZXlQcmVmaXgiLCJpc1N1cGFiYXNlQ29uZmlndXJlZCIsInN1cGFiYXNlRGlzYWJsZWQiLCJzdXBhYmFzZSIsImF1dGgiLCJwZXJzaXN0U2Vzc2lvbiIsImF1dG9SZWZyZXNoVG9rZW4iLCJnbG9iYWwiLCJoZWFkZXJzIiwiZGIiLCJzY2hlbWEiLCJ2ZXJpZnlTdXBhYmFzZUNvbm5lY3Rpb24iLCJjYXRjaCIsImVyciIsIndhcm4iLCJtZXNzYWdlIiwiaW5NZW1vcnlKb2JzIiwiZGF0YSIsImVycm9yIiwiZnJvbSIsInNlbGVjdCIsImxpbWl0IiwiY29kZSIsImVuc3VyZUpvYnNUYWJsZUV4aXN0cyIsImRldGFpbHMiLCJjaGVja1RhYmxlU3RydWN0dXJlIiwic3RhY2siLCJpbmNsdWRlcyIsIlR5cGVFcnJvciIsInNhbXBsZURhdGEiLCJmaXJzdFJvdyIsImpvaW4iLCJjcmVhdGVUYWJsZVNRTCIsImNyZWF0ZUVycm9yIiwicnBjIiwic3FsIiwiaW5zZXJ0RXJyb3IiLCJpbnNlcnQiLCJpZCIsInN0YXR1cyIsInJlc3VsdCIsImNyZWF0ZWRfYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJ1cGRhdGVkX2F0IiwiZGVsZXRlIiwiZXEiLCJzcWxFcnJvciIsImdldERiQ29tcGF0aWJsZUlkIiwiaXNOYU4iLCJOdW1iZXIiLCJoYXNoIiwiaSIsImNoYXIiLCJjaGFyQ29kZUF0IiwiTWF0aCIsImFicyIsInNob3VsZFVzZVN1cGFiYXNlIiwiaGFuZGxlU3VwYWJhc2VFcnJvciIsIm5hbWUiLCJoaW50IiwiaXNUeXBlRXJyb3IiLCJ1cGRhdGVKb2JTdGF0dXMiLCJqb2JJZCIsIm1lbW9yeUpvYiIsInVuZGVmaW5lZCIsImRiSWQiLCJzYWZlUmVzdWx0IiwiaXRpbmVyYXJ5IiwiZGF5cyIsImhhc0Nvb3JkaW5hdGVJc3N1ZXMiLCJkYXkiLCJhY3Rpdml0aWVzIiwiQXJyYXkiLCJpc0FycmF5IiwiaiIsImFjdGl2aXR5IiwiY29vcmRpbmF0ZXMiLCJ0aXRsZSIsImxhdCIsImxuZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJlIiwiZXhpc3RpbmdKb2IiLCJzaW5nbGUiLCJ1cHNlcnQiLCJvbkNvbmZsaWN0IiwiZ2V0Sm9iU3RhdHVzIiwiY3JlYXRlSm9iIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-itinerary%2Froute&page=%2Fapi%2Fgenerate-itinerary%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-itinerary%2Froute.ts&appDir=%2FUsers%2Fethanhoppe%2FDesktop%2FAItravelagent%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fethanhoppe%2FDesktop%2FAItravelagent&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();